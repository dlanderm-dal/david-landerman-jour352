<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graphic Design: Palette Recolor Preview Tool (v22)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Graphic Design: Palette Recolor Preview Tool (v22)</h1>
            <p class="subtitle-warning">Not for photographs</p>
            <p class="byline">Ineptly vibe-coded by David Landerman</p>
            <details class="instructions-credits">
                <summary>Instructions/Credits</summary>
                <div class="instructions-content">
                    <h3>Instructions:</h3>
                    <ol>
                        <li>Load in your preview image</li>
                        <li>Click "Pick Colors" inside the image preview if you don't want to use the auto extracted colors.</li>
                        <li>While picking colors, label them Background, Accent 1, Accent 2, etc to determine which origin colors recolor to which targets. This can be used to consolidate colors. You can also select Locked, which ensures the color will be exempted from the recolor transformation. If you want to change a color's category after you pick it, click the orange category label to the left of the selected color in the list.</li>
                        <li>After you pick your colors hit "Apply As Origin" this will port the selections to the Palette Mapping Panel</li>
                        <li>Once your colors are applied, determine what your target colors will be. You have several options:
                            <ol type="a">
                                <li>You can apply an Adobe Color Theme. Export a theme from color.adobe.com as a CSS file and paste the text in the box below</li>
                                <li>You can manually select with the painters palette button under the target swatch</li>
                                <li>You can use the gradient selector below</li>
                                <li>Use the color Harmony tool</li>
                            </ol>
                        </li>
                        <li>Hit Apply Recolor or toggle the Live button (this will slow everything down though)</li>
                        <li>If you want to save your color preview configuration hit the "Save Config" Button. You can save multiple configs and if you export that file you can import them later into the tool along with your original image</li>
                    </ol>

                    <h3>How To Control The Image Viewer:</h3>
                    <ul>
                        <li>Hold the Option key and Scroll to zoom in/out</li>
                        <li>While in the color picker mode if you want to get to a different part of the image, hold option and click/drag the image</li>
                    </ul>

                    <h3>Extra Fun Stuff:</h3>
                    <ul>
                        <li><strong>Color Tolerance Slider:</strong> Use this to consolidate color detection colors. After adjusting hit Re-Extract</li>
                        <li><strong>Lock Button:</strong> Under the target swatch click the lock button if you want to undo the color transformation on that particular column</li>
                        <li><strong>Shuffle Button:</strong> This shuffles the target swatches to experiment</li>
                    </ul>

                    <h3>Credits:</h3>
                    <p>With thanks to original code referenced from Princeton Demo:<br>
                    <a href="https://recolor.cs.princeton.edu/demo/index.html" target="_blank">https://recolor.cs.princeton.edu/demo/index.html</a></p>

                    <p>And the following GitHub repositories:</p>
                    <ul class="credits-links">
                        <li><a href="https://github.com/ziap/repalette" target="_blank">github.com/ziap/repalette</a></li>
                        <li><a href="https://github.com/ashish0kumar/tint" target="_blank">github.com/ashish0kumar/tint</a></li>
                        <li><a href="https://github.com/rupareddy5/Palette-based-photo-recoloring" target="_blank">github.com/rupareddy5/Palette-based-photo-recoloring</a></li>
                        <li><a href="https://github.com/pipi3838/DIP_Final" target="_blank">github.com/pipi3838/DIP_Final</a></li>
                        <li><a href="https://github.com/danielgafni/repalette" target="_blank">github.com/danielgafni/repalette</a></li>
                        <li><a href="https://github.com/b-z/photo_recoloring" target="_blank">github.com/b-z/photo_recoloring</a> (another implementation of the Princeton paper)</li>
                    </ul>
                </div>
            </details>
        </header>
        
        <div class="workspace">
            <div class="canvas-area" id="canvasArea">
                <div class="canvas-header">
                    <span class="canvas-title">Image Preview</span>
                    <div class="algorithm-toggle">
                        <span class="algorithm-toggle-label" id="algoLabelSimple" onclick="setAlgorithm('simple')">Simple</span>
                        <div class="algorithm-toggle-switch" id="algoSwitch" onclick="toggleAlgorithm()" title="Toggle recolor algorithm"></div>
                        <span class="algorithm-toggle-label" id="algoLabelRBF" onclick="setAlgorithm('rbf')">RBF</span>
                    </div>
                    <div class="btn-group">
                        <button class="btn" onclick="resetImage()">Reset</button>
                        <button class="btn" onclick="removeImage()" title="Remove image and start fresh">Remove</button>
                        <button class="btn" onclick="downloadImage()">Download</button>
                    </div>
                </div>
                <!-- Resize handles -->
                <div class="resize-handle resize-handle-right" id="resizeRight"></div>
                <div class="resize-handle resize-handle-bottom" id="resizeBottom"></div>
                <div class="resize-handle resize-handle-corner" id="resizeCorner"></div>
                
                <!-- Color tolerance slider (Advanced) -->
                <div class="tolerance-container hidden" id="toleranceContainer">
                    <div class="tolerance-header">
                        <span class="tolerance-label">Color Tolerance (Advanced)</span>
                        <div class="tolerance-controls">
                            <button class="btn btn-small" onclick="resetTolerance()">Default</button>
                            <button class="btn btn-small" onclick="reExtractWithTolerance()">Re-extract</button>
                        </div>
                    </div>
                    <div class="tolerance-slider-row">
                        <input type="range" class="slider" id="toleranceSlider" min="0" max="50" value="0">
                        <span class="tolerance-value" id="toleranceValue">0</span>
                    </div>
                </div>

                <!-- Color distribution strips - original and recolored -->
                <div class="color-strip-container hidden" id="colorStripContainer">
                    <div class="color-strip-header">
                        <span class="color-strip-label">Original Distribution</span>
                        <label class="descale-checkbox">
                            <input type="checkbox" id="descaleBgCheckbox" onchange="renderColorStrip()">
                            <span>Descale BG</span>
                        </label>
                    </div>
                    <div class="color-strip" id="colorStrip"></div>
                    <div class="color-strip-header recolored-header">
                        <span class="color-strip-label">Recolored Distribution</span>
                    </div>
                    <div class="color-strip recolored-strip" id="recoloredStrip"></div>
                </div>
                
                <div class="canvas-wrapper" id="canvasWrapper">
                    <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
                        <div class="upload-icon">üì∑</div>
                        <div class="upload-text">Click to upload an image</div>
                        <div class="upload-hint">PNG, JPG, WebP, SVG, GIF</div>
                    </div>
                    <div class="canvas-inner" id="canvasInner">
                        <canvas id="imageCanvas"></canvas>
                    </div>
                    <div class="loading-overlay hidden" id="loadingOverlay">
                        <div class="spinner"></div>
                    </div>
                    <!-- Zoom slider on left -->
                    <div class="zoom-slider-container hidden" id="zoomSliderContainer">
                        <span class="zoom-value-display" id="zoomValueDisplay">100%</span>
                        <input type="range" class="zoom-slider-vertical" id="zoomSlider" 
                               min="100" max="400" value="100" 
                               oninput="setZoomFromSlider(this.value)">
                        <span class="zoom-slider-label">ZOOM</span>
                    </div>
                    <!-- Picker overlay -->
                    <div class="picker-overlay hidden" id="pickerOverlay">
                        <button class="picker-toggle-btn" id="pickerToggleBtn" onclick="togglePickerMode()">
                            <span>üéØ</span>
                            <span>Pick Colors</span>
                        </button>
                        <div class="picker-category-selector hidden" id="pickerCategorySelector">
                            <span class="picker-category-label">Picking for:</span>
                            <select id="pickerCategorySelect" onchange="updatePickerCategory(this.value)">
                                <!-- Options populated dynamically -->
                            </select>
                        </div>
                        <div class="picker-swatches-list hidden" id="pickerSwatchesList"></div>
                        <button class="picker-apply-btn hidden" id="pickerApplyBtn" onclick="applyPickedAsOriginal()" disabled>
                            Apply as Origin
                        </button>
                        <button class="picker-clear-btn hidden" id="pickerClearBtn" onclick="clearPickerSelections()">
                            Clear Selections
                        </button>
                    </div>
                    <div class="zoom-controls hidden" id="zoomControls">
                        <button class="zoom-btn" onclick="resetZoom()" title="Reset Zoom">‚ü≤</button>
                    </div>
                    <div class="pan-hint" id="panHint">Alt+Drag to pan ‚Ä¢ Alt+Scroll to zoom</div>
                </div>
                <input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect(event)">
            </div>
            
            <div class="sidebar">
                <div class="panel">
                    <div class="panel-title">Palette Mapping</div>
                    
                    <!-- Origin count control -->
                    <div class="palette-row">
                        <span class="palette-row-label">Origin</span>
                        <div style="flex:1"></div>
                        <div class="palette-count-control">
                            <button class="palette-count-btn" onclick="changeOriginCount(-1)">‚àí</button>
                            <input type="text" id="originCountDisplay" value="5" readonly>
                            <button class="palette-count-btn" onclick="changeOriginCount(1)">+</button>
                        </div>
                    </div>
                    
                    <!-- Column-based mapping area -->
                    <div class="column-mapping-container" id="columnMappingContainer">
                        <!-- Overflow bank for >5 origins -->
                        <div class="origin-overflow-bank" id="originOverflowBank">
                            <div class="overflow-bank-title">üîí Extra Colors (Locked - No Change)</div>
                            <div class="overflow-origins-grid" id="overflowOriginsGrid"></div>
                        </div>
                        <div class="mapping-columns" id="mappingColumns">
                            <!-- Columns will be rendered here -->
                        </div>
                        <!-- Targets row (aligned horizontally) -->
                        <div class="mapping-targets-row" id="mappingTargetsRow">
                            <!-- Target swatches will be rendered here -->
                        </div>
                    </div>
                    
                    <!-- Target count control -->
                    <div class="palette-row">
                        <span class="palette-row-label">Target</span>
                        <label class="live-preview-toggle" title="Enable live preview updates">
                            <input type="checkbox" id="livePreviewToggle" onchange="toggleLivePreview(this.checked)">
                            <span class="live-preview-label">Live</span>
                        </label>
                        <div style="flex:1"></div>
                        <div class="palette-count-control">
                            <button class="palette-count-btn" onclick="changeTargetCount(-1)">‚àí</button>
                            <input type="text" id="targetCountDisplay" value="5" readonly>
                            <button class="palette-count-btn" onclick="changeTargetCount(1)">+</button>
                        </div>
                    </div>
                    
                    <div class="shuffle-row">
                        <button class="btn btn-icon" onclick="shuffleTargetPalette()" title="Shuffle colors">
                            <span>üîÄ</span>
                            <span>Shuffle</span>
                        </button>
                    </div>
                    
                    <!-- Color Gradient Picker -->
                    <div class="color-picker-area">
                        <div class="color-gradient-container" id="colorGradientContainer">
                            <div class="color-gradient-sv" id="colorGradientSV">
                                <div class="color-gradient-white"></div>
                                <div class="color-gradient-black"></div>
                                <div class="color-gradient-cursor" id="colorGradientCursor"></div>
                            </div>
                        </div>
                        <input type="range" class="color-hue-slider" id="colorHueSlider" 
                               min="0" max="360" value="0" 
                               oninput="updateGradientHue(this.value)">
                    </div>
                    
                    <div class="hex-input-row">
                        <input type="text" class="hex-input" id="hexInput" placeholder="#FF5733" maxlength="7">
                        <div class="color-preview-small" id="hexPreview"></div>
                        <button class="btn" onclick="applyHexToSelected()">Set</button>
                    </div>
                    
                    <div class="divider"></div>
                    
                    <!-- Color Harmonization -->
                    <div class="harmony-section">
                        <div class="palette-label">
                            <span>üé® Color Harmony</span>
                        </div>
                        <div style="font-size: 0.6rem; color: var(--text-muted); margin-bottom: 0.4rem; font-style: italic;">
                            Based on selected target color
                        </div>
                        <div class="harmony-row">
                            <select class="harmony-select" id="harmonyType" onchange="updateHarmonyWheel()">
                                <option value="complementary">Complementary</option>
                                <option value="analogous">Analogous</option>
                                <option value="triadic">Triadic</option>
                                <option value="split">Split-Complementary</option>
                                <option value="tetradic">Tetradic (Square)</option>
                            </select>
                            <button class="btn" onclick="harmonizePalette()">Harmonize</button>
                        </div>
                        <div class="harmony-wheel-container">
                            <canvas id="harmonyWheelCanvas" width="100" height="100"></canvas>
                        </div>
                    </div>
                    
                    <div class="divider"></div>
                    
                    <div class="slider-row">
                        <div class="slider-label">
                            <span>‚òÄÔ∏è Luminosity</span>
                            <span class="slider-value" id="luminosityValue">0</span>
                        </div>
                        <input type="range" class="slider" id="luminositySlider" min="-50" max="50" value="0" 
                               oninput="updateLuminosityValue(this.value)">
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary btn-full" onclick="applyRecolor()">Apply Recolor</button>
                    </div>

                    <!-- Config export/load section -->
                    <div class="config-section">
                        <div class="config-buttons">
                            <button class="btn" onclick="saveCurrentConfig()">Save Config</button>
                            <button class="btn" onclick="exportAllConfigs()">Export All</button>
                            <button class="btn" onclick="document.getElementById('configFileInput').click()">Import</button>
                        </div>
                        <input type="file" id="configFileInput" accept=".json" style="display:none" onchange="importConfigFile(event)">
                        <div class="config-list" id="configList"></div>
                    </div>

                    <div id="mappingDebug" style="font-size: 10px; color: #888; margin-top: 8px; word-break: break-all; font-family: monospace;"></div>
                </div>
                
                <div class="panel">
                    <div class="adobe-section">
                        <div class="adobe-title">
                            <span>üé®</span>
                            <span>Import from Adobe Color</span>
                        </div>
                        <details class="adobe-instructions">
                            <summary>How to get CSS from Adobe Color</summary>
                            <div class="adobe-instructions-content">
                                <a href="https://color.adobe.com/create/color-wheel" target="_blank">Open Adobe Color ‚Üí</a>
                                <ol>
                                    <li>Create or choose a theme</li>
                                    <li>Save it to your library</li>
                                    <li>Open the <strong>Libraries</strong> tab at the top</li>
                                    <li>Find your theme, click <strong>‚ãØ</strong> ‚Üí <strong>Copy as CSS</strong></li>
                                    <li>Paste below</li>
                                </ol>
                            </div>
                        </details>
                        <textarea class="adobe-textarea" id="adobeInput"
                                  placeholder="Paste CSS from color.adobe.com"
                                  oninput="previewAdobeColors(this.value)"></textarea>
                        <div class="import-preview hidden" id="importPreview">
                            <span class="import-label">Preview:</span>
                            <div class="import-colors" id="importColors"></div>
                        </div>
                        <button class="btn btn-full" onclick="importAdobePalette()">Import Palette</button>
                    </div>
                    
                    <div class="divider"></div>
                    
                    <!-- Theme Browser -->
                    <div class="theme-section">
                        <div class="theme-title">
                            <span>üñºÔ∏è</span>
                            <span>Theme Presets</span>
                        </div>
                        <div class="theme-scroll-container" id="themeScrollContainer"></div>
                        <button class="btn btn-full" onclick="applyTheme()">Apply Theme</button>
                    </div>
                </div>
                
                <div id="statusPanel" class="status"></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
