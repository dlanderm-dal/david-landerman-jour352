@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --bg: #f4f7f9;
    --surface: #ffffff;
    --surface-2: #eef4f8;
    --border: rgba(120, 150, 175, 0.2);
    --text: #1e3a4f;
    --text-muted: #7a94a8;
    --accent: #2b9eb3;
    --accent-dim: #1f8a9d;
    --column-line: rgba(120, 150, 175, 0.45);
}

body {
    font-family: 'Plus Jakarta Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 1.5rem;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
}

header {
    margin-bottom: 1rem;
    border-bottom: 1px solid var(--border);
    padding-bottom: 0.5rem;
}

/* Header top row: logo left, mode toggle right */
.header-top-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.25rem;
}

/* Header logo SVG */
.header-logo {
    display: flex;
}

.logo-svg {
    width: 300px;
    height: auto;
}

/* Legacy h1 rule kept for any other h1 usage */
h1 {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    margin-bottom: 0.25rem;
}

.subtitle {
    color: var(--text-muted);
    font-size: 0.85rem;
}

.subtitle-warning {
    color: var(--text-muted);
    font-size: 0.7rem;
    font-style: italic;
    margin-bottom: 0.25rem;
}

.byline {
    color: var(--text-muted);
    font-size: 0.75rem;
    font-style: italic;
    margin-bottom: 0.75rem;
}

/* Progressive instructions */
/* Collapsible instructions wrapper */
.instructions-wrapper {
    margin-top: 0.4rem;
}

.instructions-toggle {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.2rem 0;
    font-size: 0.72rem;
    color: var(--text-muted);
    font-weight: 500;
    transition: color 0.15s;
}
.instructions-toggle:hover {
    color: var(--accent);
}
.instructions-toggle-arrow {
    font-size: 0.65rem;
    transition: transform 0.15s;
}
.instructions-toggle-label {
    font-size: 0.72rem;
}

/* Header controls row: Instructions left, Mode toggle right */
.header-controls-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
}

/* Beginner / Advanced mode toggle */
.mode-toggle-wrapper {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-shrink: 0;
}

.mode-toggle-label {
    color: var(--text-muted);
    font-weight: 500;
    cursor: pointer;
    transition: color 0.15s;
    font-size: 0.85rem;
    user-select: none;
}

.mode-toggle-label.active {
    color: var(--accent);
    font-weight: 600;
}

.mode-toggle-switch {
    width: 44px;
    height: 22px;
    background: var(--border);
    border-radius: 11px;
    cursor: pointer;
    position: relative;
    transition: background 0.2s;
    border: none;
    padding: 0;
    flex-shrink: 0;
}

.mode-toggle-knob {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 18px;
    height: 18px;
    background: var(--accent);
    border-radius: 50%;
    transition: left 0.2s;
}

.mode-toggle-switch.advanced .mode-toggle-knob {
    left: 24px;
}

/* Feature number badges — REMOVED (mode configuration complete) */
.feature-num {
    display: none !important;
}
.feature-num-abs {
    display: none !important;
}

/* ============================================ */
/* BEGINNER MODE — hide/deactivate features     */
/* ============================================ */

/* Hide Import Saved Configuration */
body.mode-beginner #earlyImportSection { display: none !important; }

/* Hide entire Color Analysis collapsible (feature 12, includes 13 & 14) */
body.mode-beginner #colorAnalysisOptionalPanel { display: none !important; }

/* Hide origin swatch opacity buttons (feature 18) */
body.mode-beginner .origin-opacity-btn { display: none !important; }
body.mode-beginner .origin-opacity-popup { display: none !important; }

/* Hide shuffle button */
body.mode-beginner #shuffleBtn { display: none !important; }

/* Hide the picker OVERLAY (feature 7) — but keep sidebar button (feature 10) */
body.mode-beginner #pickerOverlay { display: none !important; }

/* In Color Harmony: hide base hue, min/max sliders, base picker, preview strip, locked toggle */
body.mode-beginner .harmony-control-row { display: none !important; }
body.mode-beginner .harmony-base-picker { display: none !important; }
body.mode-beginner .harmony-preview-strip { display: none !important; }
body.mode-beginner .harmony-include-locked-label { display: none !important; }

/* Hide "Generate Palette based on selections" button (sidebar + quick overlay) */
body.mode-beginner .harmony-btn-half:last-child { display: none !important; }
body.mode-beginner .quick-harmony-btn[onclick="quickGenerateHarmony()"] { display: none !important; }
/* With generate button gone, make randomize full width and hide "Or" divider */
body.mode-beginner .harmony-btn-row { display: flex; }
body.mode-beginner .harmony-btn-half { flex: 1 1 100% !important; }
body.mode-beginner .harmony-or-divider { display: none !important; }

/* Hide Apply Recolor button in beginner mode (Recolor Live takes over) */
body.mode-beginner #applyRecolorBtn { display: none !important; }

/* Hide the Color Adjust box */
body.mode-beginner .color-adjust-box { display: none !important; }

/* Hide "Choose your target colors" description in beginner mode */
body.mode-beginner .target-choice-description { display: none !important; }

/* Hide +/- target count control in beginner mode */
body.mode-beginner #targetControlRow .palette-count-control { display: none !important; }

/* Hide Tool Reference panel (feature 9) */
body.mode-beginner #toolLegendPanel { display: none !important; }

/* Hide "Fancy Stuff" section in instructions */
body.mode-beginner .instruction-hint-fancy { display: none !important; }

/* Beginner mode: slideshow for steps 4-6 */
body.mode-beginner .instruction-slide-advanced-only { display: none !important; }
body.mode-beginner .instruction-slide-beginner-only.active { display: flex; }

/* Advanced mode: hide beginner-only slides and nav */
body.mode-advanced .instruction-slide-beginner-only { display: none !important; }
body.mode-advanced .instruction-slide-nav { display: none !important; }

/* Beginner mode: hide slides not matching current index */
body.mode-beginner .instruction-slide.active { display: flex; }
body.mode-beginner .instruction-slide.slide-hidden { display: none !important; }

/* Hide target swatch opacity row in the color picker popup */
body.mode-beginner .swatch-picker-opacity-row { display: none !important; }

/* Direct Color Picker collapsible section for Beginner mode */
.direct-picker-section {
    display: none; /* Only shown in beginner mode */
}
body.mode-beginner .direct-picker-section {
    display: block !important;
}

.direct-picker-section summary {
    cursor: pointer;
    user-select: none;
}

.direct-picker-content {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
}

.direct-picker-icon {
    font-size: 2rem;
    flex-shrink: 0;
    line-height: 1;
}

.direct-picker-text {
    font-size: 0.78rem;
    color: var(--text);
    line-height: 1.5;
}

/* Palette icon highlight state when Direct Picker section is open */
body.mode-beginner .swatch-buttons button:first-child {
    /* Default: hidden in beginner when Direct Picker is collapsed (JS manages this) */
}

/* Palette icon orange highlight (active state via JS class) */
.swatch-buttons button.palette-icon-active {
    background: #e08530 !important;
    border-color: #e08530 !important;
    color: #ffffff !important;
    opacity: 1 !important;
}

/* Smooth show/hide for palette icons — no layout shift */
.swatch-buttons button.palette-icon-hidden {
    visibility: hidden !important;
    pointer-events: none !important;
}

/* ============================================ */
/* ADVANCED MODE — specific overrides           */
/* ============================================ */

/* Advanced mode hints that are hidden in beginner */
body.mode-beginner .instruction-hint-advanced { display: none !important; }

/* ============================================ */
/* Prevent text selection only on drag-interactive elements */
/* ============================================ */
.color-gradient-container,
.swatch-picker-gradient,
.hue-slider-track,
.canvas-wrapper,
.resize-handle,
.resize-handle-h,
.resize-handle-corner {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

.progressive-instructions {
    margin-top: 0.3rem;
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.2s ease;
    max-height: 2000px;
    opacity: 1;
}

.progressive-instructions.collapsed {
    max-height: 0;
    opacity: 0;
    margin-top: 0;
}

.instruction-step {
    display: none;
    align-items: flex-start;
    gap: 0.7rem;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    background: var(--surface);
    border: 1px solid var(--border);
    font-size: 0.95rem;
    line-height: 1.65;
    color: var(--text);
    animation: instrFadeIn 0.25s ease;
    flex-wrap: wrap;
}
.instruction-step.active {
    display: flex;
}

@keyframes instrFadeIn {
    from { opacity: 0; transform: translateY(-4px); }
    to   { opacity: 1; transform: translateY(0); }
}

.instruction-step-num {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--accent);
    color: #fff;
    font-size: 0.8rem;
    font-weight: 700;
    flex-shrink: 0;
    margin-top: 2px;
}

.instruction-step-text {
    flex: 1;
    font-size: 0.95rem;
    font-weight: 450;
    color: var(--text);
}
.instruction-step-text strong {
    color: var(--text);
    font-weight: 650;
}

/* Photograph warning in step 1 */
.photo-warning {
    color: #d9534f;
    font-style: italic;
}

/* Highlighted button names in accent blue */
.btn-highlight {
    color: var(--accent);
    font-weight: 700;
}

.instruction-hints {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    margin-top: 0.35rem;
    padding-top: 0.35rem;
    border-top: 1px solid var(--border);
    width: 100%;
}

.instruction-hint {
    font-size: 0.78rem;
    color: var(--text-muted);
    line-height: 1.5;
}
.instruction-hint strong {
    color: var(--text);
    font-weight: 600;
}

/* Hint section headings (e.g. "Options", "Fancy Stuff") */
.instruction-hint.instruction-hint-heading {
    font-weight: 700;
    color: var(--text);
    font-size: 0.82rem;
    margin-top: 0.15rem;
    opacity: 1;
}

/* Inline icons in hint text */
.hint-icon-svg {
    vertical-align: -2px;
    display: inline;
}

.hint-icon-img {
    vertical-align: -3px;
    display: inline;
}

/* Inline + icon for Add Color — mini text box style */
.hint-icon-inline {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--accent);
    color: #fff;
    font-size: 0.7rem;
    font-weight: 700;
    vertical-align: -2px;
    line-height: 1;
}
.add-color-icon-box {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: 1px dotted #b0b8c0;
    color: #b0b8c0;
    font-weight: 700;
    font-size: 0.78rem;
    padding: 0px 3px;
    margin: 0;
    border-radius: 3px;
    vertical-align: -1px;
    line-height: 1.1;
}
.add-color-label-faded {
    color: #b0b8c0;
    margin-left: 3px;
}

/* (Advanced) tag */
.advanced-tag {
    color: var(--text-muted);
    opacity: 0.6;
    font-size: 0.7rem;
    font-style: italic;
}

/* Instruction slide navigation (beginner mode) */
.instruction-slide-nav {
    display: none; /* Hidden by default, shown via JS */
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 0.4rem 0;
}
.instruction-slide-prev,
.instruction-slide-next {
    background: none;
    border: 1px solid var(--border);
    color: var(--accent);
    font-size: 0.75rem;
    font-weight: 600;
    padding: 3px 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.15s;
}
.instruction-slide-prev:hover,
.instruction-slide-next:hover {
    background: var(--surface-2);
}
.instruction-slide-prev:disabled,
.instruction-slide-next:disabled {
    opacity: 0.3;
    pointer-events: none;
}
.instruction-slide-indicator {
    font-size: 0.72rem;
    color: var(--text-muted);
    font-weight: 500;
}

/* Download button inline styling */
.btn-download-inline {
    display: inline-block;
    background: #28a745;
    color: #fff;
    font-weight: 600;
    padding: 1px 6px;
    border-radius: 4px;
    font-size: 0.72rem;
}

/* Instruction slides wrapper */
.instruction-slides-wrapper {
    display: contents;
}

/* Reassurance message */
.instruction-reassurance {
    width: 100%;
    font-size: 0.76rem;
    color: var(--text-muted);
    opacity: 0.7;
    font-style: italic;
    margin-top: 0.3rem;
    padding-top: 0.3rem;
    border-top: 1px dashed var(--border);
}

/* Footer credits */
.site-footer {
    margin-top: 2rem;
    padding-top: 1.25rem;
    border-top: 1px solid var(--border);
    font-size: 0.75rem;
    color: var(--text-muted);
    line-height: 1.6;
}
.site-footer h3 {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 0.4rem;
}
.site-footer p {
    margin-bottom: 0.35rem;
}
.site-footer a {
    color: var(--accent);
    text-decoration: none;
}
.site-footer a:hover {
    text-decoration: underline;
}

.credits-links {
    list-style: none;
    margin-left: 0 !important;
    display: flex;
    flex-wrap: wrap;
    gap: 0.15rem 1rem;
    padding: 0;
}

.credits-links li {
    font-size: 0.7rem;
}

.workspace {
    display: flex;
    flex-wrap: nowrap;
    gap: 1.5rem;
}

.canvas-area {
    background: var(--surface);
    border-radius: 12px;
    border: 1px solid var(--border);
    padding: 1rem;
    display: flex;
    flex-direction: column;
    box-shadow: 0 4px 12px rgba(120, 150, 175, 0.1);
}

.canvas-header {
    display: none; /* Content moved below image preview */
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
}

.canvas-header .btn-group {
    flex-wrap: wrap;
}

.canvas-header .btn-group .btn {
    line-height: 1.2;
    text-align: center;
    padding: 0.35rem 0.6rem;
    font-size: 0.7rem;
}

.canvas-title {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    line-height: 1.2;
}

/* Keyboard shortcut hint boxes in canvas header */
.keyboard-hints {
    display: flex;
    gap: 6px;
    align-items: center;
}

.keyboard-hints.hidden {
    display: none;
}

.key-hint {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    position: relative;
}

.key-stack {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1px;
}

.key-action {
    font-size: 0.8rem;
    color: var(--text-muted);
    letter-spacing: 0.03em;
    line-height: 1;
    white-space: nowrap;
}

.key-hint kbd {
    display: inline-block;
    padding: 2px 5px;
    font-family: system-ui, -apple-system, sans-serif;
    font-size: 0.85rem;
    font-weight: 600;
    line-height: 1.2;
    color: #333;
    background: linear-gradient(180deg, #f8f8f8, #ddd);
    border: 1px solid #bbb;
    border-bottom-width: 2px;
    border-radius: 3px;
    box-shadow: 0 1px 1px rgba(0,0,0,0.1);
    white-space: nowrap;
    min-width: 36px;
    text-align: center;
}

.key-hint > span {
    font-size: 0.85rem;
    color: var(--text-muted);
    line-height: 1.3;
    white-space: nowrap;
    text-align: center;
}

/* Ctrl and Shift hints hidden unless picker is active */
.picker-only-hint {
    display: none;
}

.keyboard-hints.picker-active {
    gap: 3px;
}

.keyboard-hints.picker-active .picker-only-hint {
    display: flex;
}

/* Warm lifted card on all key hints when picker is active */
.keyboard-hints.picker-active .key-hint {
    background: linear-gradient(180deg, #fffef8, #fff3cd);
    border: 1px solid rgba(218, 165, 32, 0.35);
    border-radius: 6px;
    padding: 5px 7px;
    box-shadow: 0 2px 8px rgba(230, 168, 23, 0.2), 0 1px 2px rgba(0,0,0,0.06);
}

.keyboard-hints.picker-active .key-hint kbd {
    background: linear-gradient(180deg, #ffffff, #ffe896);
    border-color: #c4900a;
}

.keyboard-hints.picker-active .key-hint .key-action {
    color: #8b6914;
    font-weight: 600;
}

.keyboard-hints.picker-active .key-hint > span {
    color: #5d4200;
}

/* Color Tolerance Slider */
.tolerance-container {
    margin-bottom: 0.5rem;
    padding: 8px 10px;
    background: var(--bg);
    border-radius: 6px;
    border: 1px solid var(--border);
}

.tolerance-container.hidden {
    display: none;
}

.tolerance-header {
    margin-bottom: 6px;
}

.tolerance-label-main {
    font-size: 0.8rem;
    color: var(--text);
    font-weight: 600;
}

.tolerance-optional {
    font-size: 0.65rem;
    color: var(--text-muted);
    font-weight: 400;
    font-style: italic;
}

.tolerance-sublabel {
    font-size: 0.6rem;
    color: var(--text-muted);
    font-weight: 400;
    margin-top: 2px;
}

.tolerance-controls {
    display: flex;
    gap: 4px;
    margin-top: 8px;
}

.tolerance-controls .btn-small.tolerance-dirty {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
}

.btn-small {
    padding: 3px 8px;
    font-size: 10px;
}

.tolerance-slider-row {
    display: flex;
    align-items: center;
    gap: 10px;
}

.tolerance-slider-row .slider {
    flex: 1;
}

.tolerance-value {
    font-size: 12px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--accent);
    min-width: 24px;
    text-align: right;
}

/* Color Distribution Strip - now above canvas */
.color-strip-container {
    margin-bottom: 0.5rem;
}

.color-strip-container.hidden {
    display: none;
}

.color-strip-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
}

.color-strip-label {
    font-size: 0.65rem;
    color: var(--text-muted);
}

.recolored-header {
    margin-top: 6px;
}

.recolored-strip {
    border-color: var(--accent);
}

.descale-checkbox {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 0.6rem;
    color: var(--text-muted);
    cursor: pointer;
}

.descale-checkbox input {
    width: 12px;
    height: 12px;
    cursor: pointer;
    accent-color: var(--accent);
}

.color-strip {
    display: flex;
    height: 24px;
    border-radius: 4px;
    overflow: hidden;
    border: 1px solid var(--border);
}

.color-strip-segment {
    height: 100%;
    position: relative;
    cursor: pointer;
    transition: filter 0.15s;
}

.color-strip-segment:hover {
    filter: brightness(1.15);
}

.color-strip-segment::after {
    content: attr(data-pct);
    position: absolute;
    bottom: -16px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 8px;
    color: var(--text-muted);
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.15s;
}

.color-strip-segment:hover::after {
    opacity: 1;
}

.canvas-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg);
    border-radius: 8px;
    overflow: hidden;
    position: relative;
    min-height: 200px;
    /* aspect-ratio is set dynamically by JS when image loads.
       This makes the wrapper naturally conform to the image proportions
       without any manual height calculation. */
    flex-shrink: 0;
    flex: 1;
    border: 2px solid rgba(120, 150, 175, 0.35);
}

.canvas-inner {
    /* Panzoom manages translate transforms on this element for panning.
       Zoom is handled by resizing the display canvas directly (not CSS scale).
       Do NOT set transform-origin here — Panzoom manages it internally. */
    will-change: transform;
    backface-visibility: hidden;
}

#imageCanvas {
    max-width: 100%;
    max-height: 100%;
    display: none;
    /* High-quality smooth scaling for viewing */
    image-rendering: auto;
    image-rendering: high-quality;
    -ms-interpolation-mode: bicubic;
}

#displayCanvas {
    display: none;
    /* High-quality rendering for the downscaled display */
    image-rendering: auto;
    image-rendering: high-quality;
    -ms-interpolation-mode: bicubic;
}

#webglDisplayCanvas {
    /* High-quality scaling when CSS size differs from pixel buffer */
    image-rendering: auto;
    image-rendering: high-quality;
    -ms-interpolation-mode: bicubic;
}

.upload-zone {
    text-align: center;
    padding: 3rem;
    border: 2px dashed var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.upload-zone:hover,
.upload-zone.drag-over {
    border-color: var(--accent);
    background: rgba(43, 158, 179, 0.05);
}

.upload-zone.drag-over {
    border-color: var(--accent);
    border-style: solid;
    background: rgba(43, 158, 179, 0.1);
}

.upload-zone.hidden {
    display: none;
}

.upload-icon {
    margin-bottom: 0.75rem;
    color: var(--text-muted);
    opacity: 0.45;
}

.upload-icon svg {
    display: block;
}

.upload-text {
    color: var(--text-muted);
    margin-bottom: 0.25rem;
}

.upload-hint {
    font-size: 0.75rem;
    color: var(--text-muted);
    opacity: 0.7;
}

#fileInput {
    display: none;
}

.sidebar {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.panel {
    background: var(--surface);
    border-radius: 12px;
    border: 1px solid var(--border);
    padding: 1rem;
    overflow: visible;
    box-shadow: 0 4px 12px rgba(120, 150, 175, 0.1);
}

.panel-title {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.75rem;
}

/* Collapsible Color Analysis panel */
.color-analysis-collapsible {
    cursor: default;
}
.color-analysis-summary {
    cursor: pointer;
    user-select: none;
    list-style: none;
    display: flex;
    align-items: center;
    gap: 6px;
}
.color-analysis-summary::-webkit-details-marker {
    display: none;
}
.color-analysis-summary::before {
    content: '▾';
    font-size: 0.7rem;
    color: var(--text-muted);
    transition: transform 0.15s;
}
.color-analysis-collapsible:not([open]) > .color-analysis-summary::before {
    content: '▸';
}
.color-analysis-collapsible:not([open]) > .color-analysis-summary {
    margin-bottom: 0;
}
.color-analysis-body {
    padding-top: 0.25rem;
}

.palette-section {
    margin-bottom: 1rem;
}

.palette-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.palette-row-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    min-width: 50px;
}

/* Live Preview toggle */
.live-preview-toggle {
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    margin-left: 8px;
    padding: 2px 6px;
    border-radius: 4px;
    transition: background 0.15s;
}

.live-preview-toggle:hover {
    background: var(--surface-2);
}

.live-preview-toggle input[type="checkbox"] {
    width: 12px;
    height: 12px;
    cursor: pointer;
    accent-color: var(--accent);
}

.live-preview-label {
    font-size: 0.65rem;
    color: var(--text-muted);
    user-select: none;
}

.live-preview-toggle input:checked + .live-preview-label {
    color: var(--accent);
    font-weight: 600;
}

/* Column-based mapping container */
.column-mapping-container {
    position: relative;
    margin: 0.5rem 0;
    padding-right: 0;
    overflow-x: auto;
}

/* Origin collapsible within Palette Mapping — overrides placed after .target-tool-* base rules (see below) */

/* Expand width when more targets */
.column-mapping-container[data-target-count="6"],
.column-mapping-container[data-target-count="7"],
.column-mapping-container[data-target-count="8"] {
    min-width: 500px;
}

.column-mapping-container[data-target-count="9"],
.column-mapping-container[data-target-count="10"] {
    min-width: 600px;
}

.column-mapping-container[data-target-count="11"],
.column-mapping-container[data-target-count="12"],
.column-mapping-container[data-target-count="13"],
.column-mapping-container[data-target-count="14"],
.column-mapping-container[data-target-count="15"] {
    min-width: 800px;
}

.column-mapping-container[data-target-count="16"],
.column-mapping-container[data-target-count="17"],
.column-mapping-container[data-target-count="18"],
.column-mapping-container[data-target-count="19"],
.column-mapping-container[data-target-count="20"] {
    min-width: 1000px;
}

.origin-overflow-bank {
    width: 100%;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 8px;
    margin-bottom: 12px;
    display: none;
}

.origin-overflow-bank.visible {
    display: block;
}

.overflow-bank-title {
    font-size: 10px;
    color: var(--text-muted);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.overflow-origins-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 6px 16px;
    min-height: 48px;
    padding: 4px;
    border-radius: 4px;
    transition: background 0.15s;
}

.overflow-origins-grid.drag-over {
    background: rgba(43, 158, 179, 0.08);
}

.mapping-columns {
    display: flex;
    gap: 0;
    width: 100%;
    flex-wrap: nowrap;
    align-items: stretch;
    position: relative;
}

.mapping-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    min-width: 56px;
    padding: 0;
    flex: 1;
}

.mapping-column:not(:last-child)::after {
    content: '';
    position: absolute;
    right: -2px;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--column-line);
    z-index: 1;
}

/* Targets row container - shares width with columns */
.mapping-targets-row {
    width: 100%;
    display: flex;
    gap: 0;
    border-top: 1px solid var(--border);
    align-items: stretch;
    flex-wrap: nowrap;
    position: relative;
    /* Match the horizontal padding of .origin-collapsible .target-tool-content */
    padding-left: 0.25rem;
    padding-right: 0.25rem;
}

.mapping-targets-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    flex: 1;
    min-width: 56px;
    padding: 0;
}

.mapping-targets-column:not(:last-child)::after {
    content: '';
    position: absolute;
    right: -2px;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--column-line);
    z-index: 1;
}

.column-origins {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-height: 120px;
    padding: 8px;
    border-radius: 0;
    transition: background 0.15s;
    border: 1px dashed transparent;
    flex: 1;
    width: 100%;
}

.column-origins.drag-over {
    background: rgba(43, 158, 179, 0.08);
    border-color: var(--accent);
}

.column-target {
    margin-top: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    padding: 8px;
    width: 100%;
    min-height: 80px;
}

/* Target swatch delete button - styled like origin swatch delete */
.target-delete-btn {
    position: absolute;
    top: -6px;
    right: -6px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #ef4444;
    border: 2px solid var(--surface);
    color: white;
    font-size: 10px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 10;
    line-height: 1;
}

.color-slot:hover .target-delete-btn {
    opacity: 1;
}

.target-delete-btn:hover {
    background: #dc2626;
}

/* Target swatch drag-and-drop */
.color-slot[draggable="true"] {
    cursor: grab;
}

.color-slot[draggable="true"]:active {
    cursor: grabbing;
}

.color-slot.dragging {
    opacity: 0.4;
    transform: scale(0.9);
}

.column-target.drag-over-target {
    background: rgba(43, 158, 179, 0.12);
    border-radius: 6px;
    outline: 2px dashed var(--accent);
    outline-offset: -2px;
}

/* Conflict state — two swatches stacked in one column */
.column-target.has-conflict {
    border: 2px dashed #f59e0b;
    background: rgba(245, 158, 11, 0.06);
    border-radius: 6px;
    gap: 4px;
}

.column-target.has-conflict .color-slot {
    width: 40px;
    height: 40px;
}

.column-target.has-conflict .color-slot.conflict-swatch {
    opacity: 0.85;
    border: 2px dashed rgba(245, 158, 11, 0.6);
}

/* X buttons always visible on conflict swatches (not hover-only) */
.column-target.has-conflict .color-slot .target-delete-btn {
    opacity: 1;
}

.column-percentage {
    font-size: 10px;
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    margin-top: 4px;
    font-weight: 600;
}

/* Origin swatches in columns */
.origin-swatch {
    width: 48px;
    height: 48px;
    border-radius: 6px;
    border: 2px solid var(--border);
    cursor: grab;
    position: relative;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.7);
    font-size: 12px;
}

.origin-swatch-delete {
    position: absolute;
    top: -6px;
    right: -6px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #ef4444;
    border: 2px solid var(--surface);
    color: white;
    font-size: 10px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 10;
    line-height: 1;
}

.origin-swatch:hover .origin-swatch-delete {
    opacity: 1;
}

.origin-swatch:hover {
    transform: scale(1.05);
    z-index: 10;
}

.origin-swatch.dragging {
    opacity: 0.5;
    cursor: grabbing;
}

/* Duplicate origin — wrapper gets background pad like target conflict */
.origin-swatch-wrapper.duplicate-origin {
    background: rgba(239, 68, 68, 0.12);
    border-radius: 8px;
    padding: 5px;
    transition: background 0.15s;
}

/* Hover state — yellow highlight for the whole duplicate group */
.origin-swatch-wrapper.duplicate-origin.dup-hover {
    background: rgba(234, 179, 8, 0.22);
}

.origin-swatch-number {
    position: absolute;
    font-weight: 700;
    color: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

.origin-swatch-info {
    font-size: 8px;
    color: var(--text-muted);
    white-space: nowrap;
    font-family: 'JetBrains Mono', monospace;
    text-align: center;
    margin-top: 4px;
    line-height: 1.3;
}

/* Origin swatch wrapper — swatch is the only flow element, opacity controls float outside */
.origin-swatch-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 8px;
}

/* Opacity icon button — absolutely positioned to the right of the swatch */
.origin-opacity-btn {
    width: 18px;
    height: 18px;
    padding: 0;
    border: 1.5px solid var(--border);
    border-radius: 4px;
    background: var(--surface);
    color: var(--text-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
    position: absolute;
    top: 50%;
    left: calc(100% + 2px);
    transform: translateY(-50%);
    z-index: 5;
}
.origin-opacity-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(43, 158, 179, 0.08);
}
.origin-opacity-btn.has-custom {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(43, 158, 179, 0.12);
}

/* Popup panel — appears to the left of the swatch on click, positioned via JS */
.origin-opacity-popup {
    display: none;
    background: var(--surface);
    border: 1.5px solid var(--border);
    border-radius: 6px;
    padding: 8px 9px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    z-index: 50;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    white-space: nowrap;
}
.origin-opacity-popup.open {
    display: flex;
}

/* Vertical slider — 30% taller for easier control */
.origin-opacity-slider {
    -webkit-appearance: slider-vertical;
    appearance: slider-vertical;
    writing-mode: vertical-lr;
    direction: rtl;
    width: 4px;
    height: 87px;
    background: linear-gradient(to top, var(--border), var(--accent));
    border-radius: 2px;
    outline: none;
    cursor: pointer;
    flex-shrink: 0;
}

.origin-opacity-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--accent);
    border: 2px solid #fff;
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.origin-opacity-slider::-moz-range-thumb {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--accent);
    border: 2px solid #fff;
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

/* Numeric input row in opacity popup */
.origin-opacity-input-row {
    display: flex;
    align-items: center;
    gap: 1px;
}

.origin-opacity-input {
    width: 36px;
    padding: 2px 3px;
    border: 1px solid var(--border);
    border-radius: 4px;
    background: var(--bg);
    color: var(--text);
    font-size: 10px;
    font-family: 'JetBrains Mono', monospace;
    text-align: center;
    outline: none;
}
.origin-opacity-input:focus {
    border-color: var(--accent);
}

.origin-opacity-pct {
    font-size: 9px;
    color: var(--text-muted);
}

/* Reset button in opacity popup */
.origin-opacity-reset {
    width: 20px;
    height: 16px;
    padding: 0;
    border: 1px solid var(--border);
    border-radius: 4px;
    background: var(--surface);
    color: var(--text-muted);
    cursor: pointer;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
    flex-shrink: 0;
}
.origin-opacity-reset:hover {
    border-color: var(--accent);
    color: var(--accent);
}

/* Harmony Tutorial */
.harmony-tutorial {
    margin-top: 10px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    background: var(--surface);
    overflow: hidden;
}

.harmony-tutorial-summary {
    padding: 8px 12px;
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--accent);
    cursor: pointer;
    user-select: none;
    list-style: none;
}
.harmony-tutorial-summary::-webkit-details-marker {
    display: none;
}
.harmony-tutorial-summary::before {
    content: '▸ ';
    display: inline;
    transition: transform 0.15s;
}
.harmony-tutorial[open] > .harmony-tutorial-summary::before {
    content: '▾ ';
}

.harmony-tutorial-slides {
    padding: 0 12px 10px;
}

.harmony-tutorial-slide {
    display: none;
}
.harmony-tutorial-slide.active {
    display: block;
}

.harmony-tutorial-slide-number {
    display: inline-block;
    width: 22px;
    height: 22px;
    line-height: 22px;
    text-align: center;
    border-radius: 50%;
    background: var(--accent);
    color: #fff;
    font-size: 0.72rem;
    font-weight: 700;
    margin-bottom: 4px;
}

.harmony-tutorial-slide-title {
    display: inline;
    font-size: 0.85rem;
    font-weight: 700;
    color: var(--text);
    margin-left: 6px;
}

.harmony-tutorial-slide-body {
    font-size: 0.78rem;
    color: var(--text-muted);
    line-height: 1.5;
    margin-top: 6px;
}
.harmony-tutorial-slide-body strong {
    color: var(--text);
    font-weight: 600;
}

.harmony-tutorial-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
    padding-top: 8px;
    border-top: 1px solid var(--border);
}

.harmony-tutorial-prev,
.harmony-tutorial-next {
    padding: 4px 14px;
    font-size: 0.75rem;
    font-weight: 600;
    border: 1.5px solid var(--border);
    border-radius: 5px;
    background: var(--surface);
    color: var(--text);
    cursor: pointer;
    transition: all 0.15s;
}
.harmony-tutorial-prev:hover:not(:disabled),
.harmony-tutorial-next:hover:not(:disabled) {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(43, 158, 179, 0.06);
}
.harmony-tutorial-prev:disabled,
.harmony-tutorial-next:disabled {
    opacity: 0.35;
    cursor: not-allowed;
}

/* Target swatches */
.color-slot {
    width: 48px;
    height: 48px;
    border-radius: 6px;
    border: 2px solid var(--border);
    cursor: pointer;
    transition: all 0.15s;
    position: relative;
}

.color-slot:hover {
    transform: scale(1.05);
}

.color-slot.selected {
    border-color: var(--accent);
    box-shadow: 0 0 0 2px var(--bg), 0 0 0 4px var(--accent);
}

.swatch-hex {
    font-size: 8px;
    color: var(--text-muted);
    font-family: 'JetBrains Mono', monospace;
    text-align: center;
    margin-top: 6px;
}

.swatch-buttons {
    display: flex;
    gap: 2px;
    justify-content: center;
    margin-top: 2px;
}

.swatch-buttons button {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--surface-2);
    border: 1px solid var(--border);
    color: var(--text-muted);
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.5;
    transition: all 0.15s;
}

.column-target:hover .swatch-buttons button {
    opacity: 1;
}

.swatch-buttons button:hover {
    background: #dde8ef;
    border-color: var(--border);
    color: var(--text);
}

.swatch-buttons button.is-original {
    display: none;
}

/* Bypass/Lock button */
.swatch-buttons .bypass-btn {
    opacity: 0.5;
}

.swatch-buttons .bypass-btn.active {
    opacity: 1;
    background: var(--accent);
    border-color: var(--accent);
    color: #ffffff;
    box-shadow: 0 0 6px var(--accent);
}

/* Bypass origins preview - shows individual origin colors when column is locked */
.bypass-origins-preview {
    display: flex;
    gap: 2px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 4px;
    padding: 2px;
    min-height: 18px;
}

.bypass-origin-mini {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    border: 1px solid var(--border);
    cursor: default;
}

/* Spacer to match bypass-origins-preview height when lock is off */
.bypass-origins-spacer {
    min-height: 18px;
    margin-top: 4px;
    padding: 2px;
}

.hidden-color-input {
    position: absolute;
    width: 0;
    height: 0;
    opacity: 0;
    pointer-events: none;
}

/* Per-swatch color picker dropdown */
.swatch-color-picker {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px;
    z-index: 600;
    min-width: 180px;
    display: none;
    box-shadow: 0 4px 16px rgba(120, 150, 175, 0.2);
}

.swatch-color-picker.visible {
    display: block;
}

.swatch-picker-gradient {
    position: relative;
    height: 100px;
    border-radius: 4px;
    overflow: hidden;
    cursor: crosshair;
    margin-bottom: 8px;
}

.swatch-picker-gradient-white {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to right, #fff, transparent);
}

.swatch-picker-gradient-black {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to bottom, transparent, #000);
}

.swatch-picker-cursor {
    position: absolute;
    width: 12px;
    height: 12px;
    border: 2px solid white;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    box-shadow: 0 0 0 1px rgba(120, 150, 175, 0.15);
}

.swatch-picker-hue {
    width: 100%;
    height: 14px;
    border-radius: 3px;
    -webkit-appearance: none;
    appearance: none;
    background: linear-gradient(to right,
        hsl(0, 100%, 50%),
        hsl(60, 100%, 50%),
        hsl(120, 100%, 50%),
        hsl(180, 100%, 50%),
        hsl(240, 100%, 50%),
        hsl(300, 100%, 50%),
        hsl(360, 100%, 50%)
    );
    outline: none;
    margin-bottom: 8px;
}

.swatch-picker-hue::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 6px;
    height: 18px;
    border-radius: 2px;
    background: white;
    cursor: pointer;
    border: 1px solid var(--border);
}

.swatch-picker-preview-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
}

.swatch-picker-preview {
    width: 32px;
    height: 32px;
    border-radius: 4px;
    border: 1px solid var(--border);
    flex-shrink: 0;
}

.swatch-picker-hex {
    flex: 1;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 6px 8px;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
}

.swatch-picker-apply {
    width: 100%;
    padding: 8px;
    background: var(--accent);
    border: none;
    border-radius: 4px;
    color: #ffffff;
    font-weight: 600;
    font-size: 12px;
    cursor: pointer;
    transition: background 0.15s;
}

.swatch-picker-apply:hover {
    background: var(--accent-dim);
}

/* Target opacity row in swatch picker */
.swatch-picker-opacity-row {
    display: flex;
    align-items: center;
    gap: 6px;
    margin: 6px 0;
    padding: 4px 0;
}

.swatch-picker-opacity-label {
    font-size: 0.65rem;
    color: var(--text-muted);
    white-space: nowrap;
}

.swatch-picker-opacity-slider {
    flex: 1;
    height: 4px;
    accent-color: var(--accent);
    cursor: pointer;
}

.swatch-picker-opacity-value {
    font-size: 0.65rem;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    min-width: 32px;
    text-align: right;
}

.swatch-picker-opacity-reset {
    background: none;
    border: 1px solid var(--border);
    border-radius: 3px;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 0.7rem;
    padding: 1px 4px;
    line-height: 1;
}

.swatch-picker-opacity-reset:hover {
    color: var(--accent);
    border-color: var(--accent);
}

/* Palette count controls */
.palette-count-control {
    display: flex;
    align-items: center;
    gap: 4px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2px 6px;
}

.palette-count-control input {
    width: 32px;
    background: transparent;
    border: none;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    text-align: center;
}

.palette-count-btn {
    width: 18px;
    height: 18px;
    border: none;
    background: var(--surface-2);
    color: var(--text);
    border-radius: 3px;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.palette-count-btn:hover {
    background: #dde8ef;
}

/* Add swatch button */
.add-swatch-wrapper {
    position: relative;
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 12px;
}

.add-swatch-btn {
    width: 48px;
    height: 48px;
    border: 2px dashed var(--border);
    background: var(--bg);
    color: var(--text-muted);
    border-radius: 6px;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
}

.add-swatch-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
}

.add-swatch-dropdown {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 4px;
    z-index: 200;
    max-height: 250px;
    overflow-y: auto;
    min-width: 140px;
    display: none;
    box-shadow: 0 4px 12px rgba(120, 150, 175, 0.15);
}

.add-swatch-dropdown.visible {
    display: block;
}

.add-swatch-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 8px;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.15s;
}

.add-swatch-option:hover {
    background: var(--bg);
}

.add-swatch-color {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    border: 1px solid var(--border);
    flex-shrink: 0;
}

.add-swatch-info {
    font-size: 9px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text-muted);
    line-height: 1.3;
}

.add-swatch-label {
    font-size: 8px;
    color: var(--text-muted);
    margin-top: 4px;
}

/* Origin picker popup — shows origins in a target's column, pick one to set target */
.origin-picker-popup {
    position: absolute;
    transform: translate(-50%, -100%);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 4px;
    z-index: 300;
    max-height: 250px;
    overflow-y: auto;
    min-width: 140px;
    box-shadow: 0 4px 12px rgba(120, 150, 175, 0.15);
}

.origin-picker-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 8px;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.15s;
}

.origin-picker-option:hover {
    background: var(--bg);
}

.origin-picker-color {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    border: 1px solid var(--border);
    flex-shrink: 0;
}

.origin-picker-info {
    font-size: 9px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text-muted);
    line-height: 1.3;
}

.btn-icon {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
}

.hex-input-row {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.75rem;
    align-items: center;
}

/* Color gradient picker */
.color-picker-area {
    margin-top: 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.color-gradient-container {
    position: relative;
    height: 120px;
    border-radius: 6px;
    overflow: hidden;
    cursor: crosshair;
    border: 1px solid var(--border);
}

.color-gradient-sv {
    width: 100%;
    height: 100%;
    position: relative;
}

.color-gradient-white {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to right, #fff, transparent);
}

.color-gradient-black {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to bottom, transparent, #000);
}

.color-gradient-cursor {
    position: absolute;
    width: 16px;
    height: 16px;
    border: 2px solid white;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    box-shadow: 0 0 0 1px rgba(120, 150, 175, 0.15), inset 0 0 0 1px rgba(120, 150, 175, 0.15);
}

.color-hue-slider {
    width: 100%;
    height: 16px;
    border-radius: 4px;
    -webkit-appearance: none;
    appearance: none;
    background: linear-gradient(to right, 
        hsl(0, 100%, 50%), 
        hsl(60, 100%, 50%), 
        hsl(120, 100%, 50%), 
        hsl(180, 100%, 50%), 
        hsl(240, 100%, 50%), 
        hsl(300, 100%, 50%), 
        hsl(360, 100%, 50%)
    );
    outline: none;
    border: 1px solid var(--border);
}

.color-hue-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 8px;
    height: 20px;
    border-radius: 2px;
    background: white;
    cursor: pointer;
    border: 1px solid var(--border);
    box-shadow: 0 1px 3px rgba(120, 150, 175, 0.15);
}

.color-hue-slider::-moz-range-thumb {
    width: 8px;
    height: 20px;
    border-radius: 2px;
    background: white;
    cursor: pointer;
    border: 1px solid var(--border);
    box-shadow: 0 1px 3px rgba(120, 150, 175, 0.15);
}

.hex-input {
    flex: 1;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 0.5rem 0.6rem;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
}

.hex-input:focus {
    outline: none;
    border-color: var(--accent);
}

.color-preview-small {
    width: 36px;
    height: 36px;
    border-radius: 6px;
    border: 1px solid var(--border);
}

.btn {
    background: var(--surface-2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem 0.75rem;
    color: var(--text);
    font-family: inherit;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.15s;
    font-weight: 500;
}

.btn:hover {
    background: #dde8ef;
}

.btn-primary {
    background: var(--accent);
    border-color: var(--accent);
    color: #ffffff;
    font-weight: 600;
}

.btn-primary:hover {
    background: var(--accent-dim);
    border-color: var(--accent-dim);
}

.btn-full {
    width: 100%;
}

.btn-group {
    display: flex;
    gap: 0.5rem;
}

.btn-group.hidden {
    display: none;
}

.btn-group .btn {
    flex: 1;
}

.algorithm-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 10px;
    color: var(--text-muted);
    margin-right: 12px;
}

.algorithm-toggle-label {
    cursor: pointer;
    padding: 3px 6px;
    border-radius: 4px;
    transition: all 0.15s;
}

.algorithm-toggle-label:hover {
    background: var(--surface-2);
}

.algorithm-toggle-label.active {
    background: var(--accent);
    color: #ffffff;
    font-weight: 600;
}

.algorithm-toggle-switch {
    width: 36px;
    height: 18px;
    background: var(--surface-2);
    border-radius: 9px;
    position: relative;
    cursor: pointer;
    transition: background 0.2s;
}

.algorithm-toggle-switch::after {
    content: '';
    position: absolute;
    width: 14px;
    height: 14px;
    background: var(--text-muted);
    border-radius: 50%;
    top: 2px;
    left: 2px;
    transition: all 0.2s;
}

.algorithm-toggle-switch.rbf::after {
    left: 20px;
    background: var(--accent);
}

.divider {
    height: 1px;
    background: var(--border);
    margin: 1rem 0;
}

.adobe-section {
    margin-top: 0.25rem;
}

.adobe-color-link-top {
    display: inline-block;
    color: var(--accent);
    font-size: 0.7rem;
    font-weight: 600;
    text-decoration: none;
    margin-bottom: 0.25rem;
}

.adobe-color-link-top:hover {
    text-decoration: underline;
}

.adobe-title {
    font-size: 0.7rem;
    color: var(--accent);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.adobe-instructions {
    margin-bottom: 0.5rem;
}

.adobe-instructions summary {
    cursor: pointer;
    color: var(--accent);
    font-size: 0.65rem;
    font-weight: 500;
    padding: 0.2rem 0;
    user-select: none;
}

.adobe-instructions summary:hover {
    color: var(--accent-dim);
}

.adobe-instructions[open] summary {
    margin-bottom: 0.4rem;
}

.adobe-instructions-content {
    font-size: 0.65rem;
    color: var(--text-muted);
    line-height: 1.5;
    padding-left: 0.5rem;
    border-left: 2px solid var(--border);
}

.adobe-instructions-content a {
    color: var(--accent);
    text-decoration: none;
    font-weight: 500;
}

.adobe-instructions-content a:hover {
    text-decoration: underline;
}

.adobe-instructions-content ol {
    margin: 0.4rem 0 0 1rem;
    padding: 0;
}

.adobe-instructions-content li {
    margin-bottom: 0.15rem;
}

.adobe-instructions-content strong {
    color: var(--text);
}

.adobe-textarea {
    width: 100%;
    background: #f7fafb;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem 0.6rem;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    margin-bottom: 0.5rem;
    resize: vertical;
    min-height: 60px;
}

.adobe-textarea:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(43, 158, 179, 0.15);
}

.import-preview {
    background: var(--bg);
    border-radius: 6px;
    padding: 0.5rem;
    margin-bottom: 0.5rem;
}

.import-preview.hidden {
    display: none;
}

.import-label {
    font-size: 0.65rem;
    color: var(--text-muted);
    display: block;
    margin-bottom: 0.4rem;
}

.import-colors {
    display: flex;
    gap: 0.25rem;
    flex-wrap: wrap;
}

.import-color-chip {
    width: 28px;
    height: 28px;
    border-radius: 4px;
    border: 1px solid var(--border);
}

.status {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-align: center;
    padding: 0.5rem;
}

.loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(244, 247, 249, 0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
}

.loading-overlay.hidden {
    display: none;
}

.spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Luminosity Slider */
.slider-row {
    margin: 0.75rem 0;
}

.luminosity-btn-row {
    display: flex;
    gap: 6px;
    margin-top: 0.5rem;
    align-items: center;
}

.luminosity-btn-row .btn-full {
    flex: 1;
}

.slider-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 0.4rem;
}

.slider-value {
    font-family: 'JetBrains Mono', monospace;
    color: var(--accent);
}

.slider {
    width: 100%;
    height: 6px;
    border-radius: 3px;
    background: var(--border);
    outline: none;
    -webkit-appearance: none;
    appearance: none;
    border: 1px solid rgba(120, 150, 175, 0.3);
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 2px solid var(--surface);
    box-shadow: 0 1px 4px rgba(43, 158, 179, 0.3);
}

/* Theme Browser */
.theme-section {
    margin-top: 0.5rem;
}

.theme-title {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.theme-scroll-container {
    max-height: 180px;
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: var(--bg);
    margin-bottom: 0.5rem;
}

.theme-list-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 3px 8px;
    font-size: 9px;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    border-bottom: 1px solid var(--border);
}
.theme-list-header span {
    white-space: nowrap;
}
.theme-list-header .theme-header-name {
    min-width: 90px;
    flex: 1;
}
.theme-list-header .theme-header-match {
    min-width: 32px;
    text-align: center;
}

.theme-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 8px;
    cursor: pointer;
    transition: background 0.15s;
    border-bottom: 1px solid var(--border);
}

.theme-item:last-child {
    border-bottom: none;
}

.theme-item:hover {
    background: var(--surface-2);
}

.theme-item.selected {
    background: rgba(43, 158, 179, 0.08);
    border-left: 3px solid var(--accent);
}

.theme-item-name {
    font-size: 11px;
    color: var(--text);
    min-width: 90px;
    flex: 1;
}

.theme-item-match {
    font-size: 9px;
    padding: 2px 5px;
    border-radius: 8px;
    font-weight: 600;
    min-width: 32px;
    text-align: center;
}

.theme-item-match.high {
    background: rgba(34, 197, 94, 0.12);
    color: #16a34a;
}

.theme-item-match.medium {
    background: rgba(234, 179, 8, 0.12);
    color: #ca8a04;
}

.theme-item-match.low {
    background: rgba(107, 114, 128, 0.12);
    color: #6b7280;
}

.theme-item-swatches {
    display: flex;
    gap: 2px;
}

.theme-item-swatch {
    width: 14px;
    height: 14px;
    border-radius: 2px;
    border: 1px solid rgba(120, 150, 175, 0.15);
}

/* Picker Mode */
.picker-overlay {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 8px;
    z-index: 200;
    transition: opacity 0.2s ease;
}

.picker-overlay.hidden {
    display: none;
}

.picker-toggle-btn {
    padding: 8px 12px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-size: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.15s;
    box-shadow: 0 2px 6px rgba(120, 150, 175, 0.1);
}

.picker-toggle-btn .picker-toggle-text {
    text-align: left;
    line-height: 1.3;
}

.picker-toggle-btn .picker-toggle-subtitle {
    font-size: 9px;
    opacity: 0.85;
}

.picker-toggle-btn:hover {
    background: var(--surface-2);
}

.picker-toggle-btn.active {
    background: #e6a817;
    color: #333;
    border-color: #c4900a;
}

.picker-toggle-btn.active .picker-toggle-subtitle {
    color: #333;
}

.picker-toggle-btn.colors-picked.active,
.picker-toggle-btn.colors-picked.active .picker-toggle-subtitle {
    color: #333;
}

.picker-swatches-list {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 6px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    /* Cap at ~3 swatch items (each ~32px + 4px gap + 12px container padding), then scroll */
    max-height: 116px;
    overflow-y: auto;
}

.picker-swatches-list.hidden {
    display: none;
}

.picker-swatch-item {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.15s;
}

.picker-swatch-item:hover {
    background: var(--bg);
}

.picker-swatch-color {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    border: 1px solid var(--border);
    flex-shrink: 0;
}

.picker-swatch-info {
    font-size: 10px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text-muted);
    line-height: 1.3;
}

.picker-swatch-delete {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #ef4444;
    color: white;
    border: none;
    font-size: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.15s;
    margin-left: auto;
}

.picker-swatch-item:hover .picker-swatch-delete {
    opacity: 1;
}

/* Category label in picker swatch list */
.picker-swatch-category {
    font-size: 10px;
    font-weight: 600;
    font-family: 'JetBrains Mono', monospace;
    color: #e08530;
    min-width: 20px;
    text-align: center;
}

.picker-swatch-category.clickable {
    cursor: pointer;
    padding: 2px 4px;
    border-radius: 3px;
    transition: background 0.15s, color 0.15s;
}

.picker-swatch-category.clickable:hover {
    background: #e08530;
    color: #ffffff;
}

/* Category selector in picker overlay */
.picker-category-selector {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 10px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
}

.picker-category-selector.hidden {
    display: none;
}

.picker-category-label {
    font-size: 10px;
    color: var(--text-muted);
    white-space: nowrap;
}

.picker-category-selector.category-flash {
    animation: categoryFlash 0.3s ease;
}

@keyframes categoryFlash {
    0% { box-shadow: 0 0 0 0 rgba(224, 133, 48, 0.6); }
    50% { box-shadow: 0 0 8px 3px rgba(224, 133, 48, 0.4); }
    100% { box-shadow: 0 0 0 0 rgba(224, 133, 48, 0); }
}

.picker-category-selector select {
    flex: 1;
    padding: 4px 6px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--text);
    font-size: 11px;
    font-family: inherit;
    cursor: pointer;
}

/* Target category labels below swatches */
.target-category-label {
    font-size: 9px;
    color: var(--text-muted);
    text-align: left;
    margin-bottom: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 60px;
}

.picker-apply-btn {
    padding: 6px 10px;
    background: #28a745;
    color: #ffffff;
    border: none;
    border-radius: 4px;
    font-size: 11px;
    cursor: pointer;
    font-weight: 500;
}

.picker-apply-btn:hover {
    filter: brightness(1.1);
}

.picker-apply-btn.hidden {
    display: none;
}

.picker-clear-btn {
    padding: 5px 10px;
    background: #dc3545;
    color: #ffffff;
    border: 1px solid #c82333;
    border-radius: 4px;
    font-size: 10px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.15s;
}

.picker-clear-btn:hover {
    background: #c82333;
    color: #ffffff;
    border-color: #b21f2d;
}

.picker-clear-btn.hidden {
    display: none;
}

.picker-marker {
    position: absolute;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 3px solid white;
    box-shadow: 0 2px 8px rgba(120, 150, 175, 0.2), inset 0 0 0 2px rgba(120, 150, 175, 0.15);
    cursor: grab;
    transform: translate(-50%, -50%);
    z-index: 100;
}

.picker-marker:hover {
    transition: transform 0.1s, box-shadow 0.1s;
    transform: translate(-50%, -50%) scale(1.15);
}

.picker-marker.dragging {
    cursor: grabbing;
    transform: translate(-50%, -50%) scale(1.2);
}

/* Hover marker shown when hovering over an origin swatch */
.origin-hover-marker {
    position: absolute;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 3px solid white;
    box-shadow: 0 0 0 2px rgba(0,0,0,0.3), 0 4px 16px rgba(0,0,0,0.4);
    transform: translate(-50%, -50%);
    z-index: 200;
    pointer-events: none;
    animation: hover-marker-pulse 0.8s ease-in-out infinite alternate;
}

.origin-hover-marker-label {
    position: absolute;
    top: -22px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 10px;
    font-weight: 600;
    color: #fff;
    background: rgba(0,0,0,0.7);
    padding: 2px 6px;
    border-radius: 4px;
    white-space: nowrap;
}

@keyframes hover-marker-pulse {
    from { box-shadow: 0 0 0 2px rgba(0,0,0,0.3), 0 4px 16px rgba(0,0,0,0.4); }
    to { box-shadow: 0 0 0 4px rgba(255,255,255,0.6), 0 4px 20px rgba(0,0,0,0.5); }
}

.picker-marker-label {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--surface);
    color: var(--text);
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    white-space: nowrap;
    pointer-events: none;
    border: 1px solid var(--border);
}

.picker-marker-delete {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #ef4444;
    border: 2px solid white;
    color: white;
    font-size: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.15s;
}

.picker-marker:hover .picker-marker-delete {
    opacity: 1;
}

/* Zoom Controls */
.zoom-controls {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 4px;
    z-index: 150;
    transition: opacity 0.2s ease;
}

.zoom-controls.hidden {
    display: none;
}

.zoom-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s;
    box-shadow: 0 2px 6px rgba(120, 150, 175, 0.1);
}

.zoom-btn:hover {
    background: var(--surface-2);
}

.zoom-btn-wide {
    width: auto;
    padding: 0 10px;
    gap: 4px;
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
}

.reset-view-icon {
    font-size: 20px;
    line-height: 1;
}

.canvas-tools-column {
    position: absolute;
    left: 4px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
    z-index: 150;
    pointer-events: none;
}
.canvas-tools-column > * {
    pointer-events: auto;
}

.zoom-slider-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 6px 2px;
    transition: opacity 0.2s ease;
    box-shadow: 0 2px 6px rgba(120, 150, 175, 0.1);
}

.zoom-slider-container.hidden {
    display: none;
}

.zoom-slider-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--text);
    letter-spacing: 2px;
}

.zoom-slider-vertical {
    -webkit-appearance: none;
    appearance: none;
    width: 70px;
    height: 3px;
    border-radius: 2px;
    background: var(--bg);
    outline: none;
    transform: rotate(-90deg);
    transform-origin: center center;
    margin: 32px 0;
}

.zoom-slider-vertical::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 1px solid var(--surface);
}

.zoom-value-display {
    font-size: 12px;
    font-weight: 700;
    font-family: 'JetBrains Mono', monospace;
    color: var(--accent);
    min-width: 34px;
    text-align: center;
}

.pan-hint {
    position: absolute;
    bottom: 48px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 4px 10px;
    font-size: 10px;
    color: var(--text-muted);
    z-index: 50;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s;
}

.canvas-wrapper.zoomed .pan-hint {
    opacity: 1;
}

.canvas-wrapper.panning {
    cursor: grabbing;
}

.canvas-wrapper.can-pan {
    cursor: grab;
}

/* When zoomed, disable flex centering so pan math is clean (origin = top-left) */
.canvas-wrapper.zoomed {
    justify-content: flex-start;
    align-items: flex-start;
}

.canvas-wrapper.picking-mode {
    cursor: crosshair;
}

.canvas-wrapper.alt-held {
    cursor: grab !important;
}

.canvas-wrapper.alt-held.panning {
    cursor: grabbing !important;
}

/* Harmony Mode Toggle (Lock a Harmony / Lock a Color) */
.harmony-mode-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 10px;
    color: var(--text-muted);
    margin-bottom: 0.6rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border);
}

.harmony-mode-label {
    cursor: pointer;
    padding: 3px 7px;
    border-radius: 4px;
    transition: all 0.15s;
    white-space: nowrap;
    user-select: none;
}

.harmony-mode-label:hover {
    background: var(--surface-2);
}

.harmony-mode-label.active {
    background: var(--accent);
    color: #ffffff;
    font-weight: 600;
}

.harmony-mode-switch {
    width: 36px;
    height: 18px;
    background: var(--surface-2);
    border-radius: 9px;
    position: relative;
    cursor: pointer;
    transition: background 0.2s;
    flex-shrink: 0;
    border: 1px solid var(--border);
}

.harmony-mode-switch::after {
    content: '';
    position: absolute;
    width: 14px;
    height: 14px;
    background: var(--text-muted);
    border-radius: 50%;
    top: 1px;
    left: 2px;
    transition: left 0.2s, background 0.2s;
}

.harmony-mode-switch.color-mode::after {
    left: 19px;
    background: var(--accent);
}

.harmony-mode-panel.hidden {
    display: none;
}

.lock-color-result-label {
    margin-top: 0.4rem;
    padding: 0.3rem 0.5rem;
    background: rgba(43, 158, 179, 0.06);
    border: 1px solid rgba(43, 158, 179, 0.15);
    border-radius: 6px;
    font-size: 0.65rem;
    color: var(--accent);
    text-align: center;
    font-weight: 500;
}

.lock-color-result-label.hidden {
    display: none;
}

/* Swatch-style lock-a-color picker (matches Add Color bank) */
.lock-color-swatch-picker {
    display: flex;
    flex-direction: column;
    gap: 2px;
    margin-bottom: 0.5rem;
    max-height: 180px;
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: var(--surface);
    padding: 4px;
}

.lock-color-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px 8px;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.1s;
}

.lock-color-option:hover {
    background: var(--bg);
}

.lock-color-option.selected {
    background: rgba(43, 158, 179, 0.1);
    outline: 2px solid var(--accent);
    outline-offset: -2px;
}

.lock-color-swatch {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    border: 1px solid var(--border);
    flex-shrink: 0;
}

.lock-color-info {
    font-size: 9px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text-muted);
    line-height: 1.3;
}

/* Quick bar compact version */
.quick-lock-color-select-wrapper {
    display: flex;
    gap: 3px;
    align-items: center;
    flex: 1;
    min-width: 0;
    overflow-x: auto;
}

.quick-lock-color-chip {
    width: 26px;
    height: 26px;
    border-radius: 4px;
    border: 2px solid transparent;
    cursor: pointer;
    flex-shrink: 0;
    transition: border-color 0.15s, transform 0.1s;
    position: relative;
}

.quick-lock-color-chip:hover {
    transform: scale(1.1);
    border-color: var(--text-muted);
}

.quick-lock-color-chip.selected {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px var(--accent);
}

.quick-lock-color-chip[title]::after {
    content: '';
}

/* === Sidebar: Locked targets compact horizontal row === */
.lock-color-locked-section {
    margin-top: 6px;
    padding-top: 6px;
    border-top: 1px dashed var(--border);
}

.lock-color-locked-label {
    font-size: 8px;
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 4px;
    letter-spacing: 0.03em;
}

.lock-color-locked-row {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    align-items: center;
}

.lock-color-locked-chip {
    display: flex;
    align-items: center;
    gap: 3px;
    padding: 3px 6px 3px 3px;
    border-radius: 4px;
    border: 1.5px solid var(--border);
    background: var(--bg);
    cursor: pointer;
    transition: all 0.12s;
}

.lock-color-locked-chip:hover {
    border-color: var(--text-muted);
    background: var(--surface-2);
}

.lock-color-locked-chip.selected {
    border-color: var(--accent);
    background: rgba(43, 158, 179, 0.08);
    box-shadow: 0 0 0 1px var(--accent);
}

.lock-color-locked-chip-swatch {
    width: 14px;
    height: 14px;
    border-radius: 3px;
    border: 1px solid rgba(120, 150, 175, 0.25);
    flex-shrink: 0;
}

.lock-color-locked-chip-label {
    font-size: 8px;
    font-weight: 600;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text-muted);
    line-height: 1;
}

.lock-color-locked-chip.selected .lock-color-locked-chip-label {
    color: var(--accent);
}

/* === Quick bar: Locked targets dropdown button === */
.quick-locked-btn-wrapper {
    position: relative;
    display: inline-flex;
    align-items: center;
    flex-shrink: 0;
    margin-left: 2px;
}

.quick-locked-add-btn {
    width: 26px;
    height: 26px;
    border: 2px dashed var(--border);
    background: var(--bg);
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
    padding: 0;
    line-height: 1;
    position: relative;
}
/* "L" indicator on the left of a selected locked swatch */
.quick-locked-L {
    position: absolute;
    left: -9px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.5rem;
    font-weight: 700;
    color: var(--text-muted);
    line-height: 1;
    pointer-events: none;
}

.quick-locked-add-btn:hover {
    border-color: var(--accent);
    background: rgba(43, 158, 179, 0.06);
}

.quick-locked-add-btn.has-selection {
    border-width: 2px;
    box-shadow: 0 0 0 1px var(--accent);
}

.quick-locked-add-btn.has-selection:hover {
    transform: scale(1.1);
    background: inherit;
}

.quick-locked-dropdown {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 4px;
    z-index: 200;
    max-height: 220px;
    overflow-y: auto;
    min-width: 140px;
    display: none;
    box-shadow: 0 4px 12px rgba(120, 150, 175, 0.15);
    margin-bottom: 4px;
}

.quick-locked-dropdown.visible {
    display: block;
}

/* Quick bar mode toggle (compact) */
.quick-harmony-mode-toggle {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 9px;
    color: var(--text-muted);
    flex-shrink: 0;
}

.quick-harmony-mode-label {
    cursor: pointer;
    padding: 2px 5px;
    border-radius: 3px;
    transition: all 0.15s;
    white-space: nowrap;
    user-select: none;
}

.quick-harmony-mode-label:hover {
    background: var(--surface);
}

.quick-harmony-mode-label.active {
    background: var(--accent);
    color: #ffffff;
    font-weight: 600;
}

.quick-harmony-mode-switch {
    width: 28px;
    height: 14px;
    background: var(--surface);
    border-radius: 7px;
    position: relative;
    cursor: pointer;
    transition: background 0.2s;
    flex-shrink: 0;
    border: 1px solid var(--border);
}

.quick-harmony-mode-switch::after {
    content: '';
    position: absolute;
    width: 10px;
    height: 10px;
    background: var(--text-muted);
    border-radius: 50%;
    top: 1px;
    left: 2px;
    transition: left 0.2s, background 0.2s;
}

.quick-harmony-mode-switch.color-mode::after {
    left: 15px;
    background: var(--accent);
}

.quick-harmony-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex: 1;
    min-width: 0;
}

.quick-harmony-controls.hidden {
    display: none;
}

.quick-harmony-result {
    font-size: 0.6rem;
    color: var(--accent);
    font-weight: 500;
    text-align: center;
    padding: 0.2rem 0.4rem;
    background: rgba(43, 158, 179, 0.06);
    border: 1px solid rgba(43, 158, 179, 0.15);
    border-radius: 4px;
    width: 100%;
}

.quick-harmony-result.hidden {
    display: none;
}

/* Harmony Section */
.harmony-section {
    margin-top: 0.5rem;
}

.harmony-row {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

/* Harmony control rows (base hue, sat range, lit range) */
.harmony-control-row {
    display: flex;
    align-items: center;
    gap: 4px;
    margin: 6px 0;
}

.harmony-control-label {
    font-size: 0.6rem;
    color: var(--text-muted);
    min-width: 52px;
    white-space: nowrap;
}

.harmony-hue-slider {
    flex: 1;
    height: 6px;
    -webkit-appearance: none;
    appearance: none;
    border-radius: 3px;
    background: linear-gradient(to right,
        hsl(0,80%,50%), hsl(60,80%,50%), hsl(120,80%,50%),
        hsl(180,80%,50%), hsl(240,80%,50%), hsl(300,80%,50%), hsl(360,80%,50%));
    outline: none;
    cursor: pointer;
}

.harmony-hue-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: #fff;
    border: 2px solid var(--text);
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
}

.harmony-brightness-slider {
    flex: 1;
    height: 6px;
    -webkit-appearance: none;
    appearance: none;
    border-radius: 3px;
    background: linear-gradient(to right, hsl(180,70%,5%), hsl(180,70%,50%), hsl(180,70%,95%));
    outline: none;
    cursor: pointer;
}

.harmony-brightness-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: #fff;
    border: 2px solid var(--text);
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
}

.harmony-range-slider {
    flex: 1;
    height: 4px;
    accent-color: var(--accent);
    cursor: pointer;
    min-width: 30px;
}

.harmony-control-value {
    font-size: 0.6rem;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text);
    min-width: 22px;
    text-align: right;
}

.harmony-control-sep {
    font-size: 0.6rem;
    color: var(--text-muted);
}

.harmony-range-label {
    font-size: 0.55rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.03em;
    min-width: 18px;
    text-align: center;
}

.harmony-select {
    flex: 1;
    background: #f7fafb;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.4rem 0.5rem;
    color: var(--text);
    font-family: inherit;
    font-size: 0.7rem;
}

.harmony-select:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(43, 158, 179, 0.15);
}

.palette-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Nudge selection hint (shown in Harmony mode only) */
.harmony-nudge-hint {
    font-size: 0.55rem;
    color: var(--text-muted);
    font-style: italic;
    text-align: center;
    margin: 0.3rem 0 0;
    line-height: 1.3;
}
.harmony-nudge-hint.hidden {
    display: none;
}

/* Harmony wheel */
.harmony-wheel-container {
    display: flex;
    justify-content: center;
    margin: 0.5rem 0;
    position: relative;
    overflow: visible;
}

#harmonyWheelCanvas {
    border-radius: 50%;
}

.btn-randomize-harmony {
    background: var(--surface-2);
    border: 1px dashed var(--border);
    font-size: 0.65rem;
    transition: border-color 0.2s, background 0.2s;
    padding: 5px 8px;
    white-space: normal;
    text-align: center;
    line-height: 1.3;
}
.btn-randomize-harmony:hover {
    border-color: var(--accent);
    background: rgba(43, 158, 179, 0.06);
}

/* Side-by-side Generate + Randomize row */
/* Live preview strip */
/* Base slot picker */
.harmony-base-picker {
    display: flex;
    align-items: center;
    gap: 6px;
    margin: 0.3rem 0 0.1rem;
    flex-wrap: wrap;
}
.harmony-base-picker-label {
    font-size: 0.6rem;
    color: var(--text-muted);
    white-space: nowrap;
}
.harmony-base-picker-list {
    display: flex;
    gap: 3px;
    flex-wrap: wrap;
}
.harmony-base-picker-item {
    display: flex;
    align-items: center;
    gap: 3px;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.55rem;
    cursor: pointer;
    border: 1.5px solid transparent;
    background: var(--surface-alt);
    color: var(--text);
    transition: border-color 0.15s, background 0.15s;
}
.harmony-base-picker-item:hover {
    background: var(--surface);
    border-color: var(--border);
}
.harmony-base-picker-item.selected {
    border-color: var(--accent);
    background: rgba(56, 189, 248, 0.08);
}
.harmony-base-picker-item.is-locked {
    opacity: 0.6;
    border-style: dashed;
    border-color: rgba(120, 150, 175, 0.3);
}
.harmony-base-picker-item.is-locked:hover {
    opacity: 0.85;
    border-color: var(--text-muted);
}
.harmony-base-picker-item.is-locked.selected {
    opacity: 0.85;
    border-color: var(--accent);
    border-style: dashed;
}
.harmony-base-picker-swatch {
    width: 10px;
    height: 10px;
    border-radius: 2px;
    border: 1px solid rgba(120, 150, 175, 0.3);
    flex-shrink: 0;
}

/* Locked origin color popup */
.harmony-base-origin-popup {
    z-index: 100;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 6px 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    min-width: 80px;
}
.harmony-base-origin-title {
    font-size: 0.55rem;
    color: var(--text-muted);
    margin-bottom: 4px;
    white-space: nowrap;
}
.harmony-base-origin-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
}
.harmony-base-origin-swatch {
    width: 22px;
    height: 22px;
    border-radius: 3px;
    border: 1.5px solid rgba(120, 150, 175, 0.3);
    cursor: pointer;
    transition: border-color 0.15s, transform 0.1s;
}
.harmony-base-origin-swatch:hover {
    border-color: #fff;
    transform: scale(1.15);
}
.harmony-base-origin-swatch.selected {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px var(--accent);
}

/* Include locked colors toggle */
.harmony-include-locked-label {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.6rem;
    color: var(--text-muted);
    cursor: pointer;
    margin: 0.25rem 0 0.15rem;
    user-select: none;
}
.harmony-include-locked-label input[type="checkbox"] {
    width: 13px;
    height: 13px;
    margin: 0;
    accent-color: var(--accent);
}

.harmony-preview-strip {
    display: flex;
    gap: 3px;
    margin: 0.4rem 0 0.15rem;
    min-height: 28px;
    align-items: flex-end;
}
.harmony-preview-swatch {
    flex: 1;
    height: 24px;
    border-radius: 3px;
    border: 1px solid rgba(120, 150, 175, 0.2);
    position: relative;
    transition: background 0.1s;
}
.harmony-preview-swatch.is-base {
    height: 28px;
    border: 2px solid #fff;
    box-shadow: 0 0 0 1px var(--accent);
}
.harmony-preview-swatch.is-base::after {
    content: 'base';
    position: absolute;
    top: -13px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 7px;
    font-weight: 600;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    white-space: nowrap;
}
.harmony-preview-swatch.is-locked {
    opacity: 0.35;
    height: 18px;
}

.harmony-btn-row {
    display: flex;
    gap: 6px;
    margin-top: 0.5rem;
}
.harmony-btn-half {
    flex: 1;
    min-width: 0;
}

/* "Or" divider between button groups */
.harmony-or-divider {
    text-align: center;
    font-size: 0.65rem;
    color: var(--text-muted);
    opacity: 0.6;
    margin: 4px 0;
    font-style: italic;
}

/* Nudge button row with inline mini swatch */
.harmony-nudge-row {
    margin-top: 0;
}
.harmony-nudge-btn {
    font-size: 0.68rem !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    gap: 6px;
}
.harmony-nudge-swatch {
    display: inline-block;
    width: 14px;
    height: 14px;
    border-radius: 3px;
    border: 1px solid var(--border);
    vertical-align: middle;
    flex-shrink: 0;
}

.harmony-dot {
    position: absolute;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    cursor: grab;
    border: 2px solid #fff;
    transform: translate(-50%, -50%);
    transition: transform 0.1s, box-shadow 0.1s;
    z-index: 10;
}

.harmony-dot:hover {
    transform: translate(-50%, -50%) scale(1.3);
    box-shadow: 0 0 8px rgba(43, 158, 179, 0.4);
    z-index: 20;
}

.harmony-dot.dragging {
    cursor: grabbing;
    transform: translate(-50%, -50%) scale(1.4);
    box-shadow: 0 0 12px rgba(43, 158, 179, 0.5);
    z-index: 30;
}

.harmony-dot.selected {
    border-width: 3px;
    box-shadow: 0 0 6px rgba(43, 158, 179, 0.6);
    z-index: 15;
}


/* Config export/load section */
.config-section {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--border);
}

.save-history-box {
    margin-top: 0.75rem;
    padding: 8px 10px;
    background: var(--bg);
    border-radius: 6px;
    border: 1px solid var(--border);
}

.save-history-box-title {
    font-size: 0.8rem;
    color: var(--text);
    font-weight: 600;
    display: block;
    margin-bottom: 8px;
}

.btn-save-config {
    font-size: 0.85rem;
    padding: 0.6rem 1rem;
    margin-bottom: 0.5rem;
    transition: opacity 0.2s, background 0.2s;
}
.btn-save-config.btn-disabled {
    opacity: 0.45;
    pointer-events: none;
    cursor: default;
}

/* Faded state for save/download/export buttons before any recolor exists */
.btn-pre-recolor-faded {
    opacity: 0.35;
    pointer-events: none;
    cursor: default;
    filter: grayscale(0.5);
}

.btn-download-recolor {
    font-size: 0.85rem;
    padding: 0.6rem 1rem;
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
    background: #28a745;
    color: #fff;
    border: none;
    font-weight: 600;
}
.btn-download-recolor:hover {
    background: #218838;
}

.config-import-export-row {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
}

.config-import-export-row .btn {
    flex: 1;
}

.config-history-header {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 0.5rem;
    margin-bottom: 0.35rem;
}

.config-buttons {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.config-list {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: var(--bg);
}

.config-list:empty::after {
    content: 'No recolor history yet';
    display: block;
    padding: 12px;
    text-align: center;
    color: var(--text-muted);
    font-size: 11px;
    font-style: italic;
}

/* "What is this?" collapsible under recolor history */
/* "What is this?" collapsible — styled card */
.what-is-this-collapsible {
    margin-top: 0.6rem;
    border: 1px dashed var(--border);
    border-radius: 8px;
    overflow: hidden;
    background: var(--surface);
    transition: border-color 0.15s;
}
.what-is-this-collapsible[open] {
    border-style: solid;
    border-color: var(--accent);
}
.what-is-this-summary {
    font-size: 0.72rem;
    font-weight: 600;
    color: var(--text-muted);
    padding: 7px 12px;
    cursor: pointer;
    user-select: none;
    list-style: none;
    transition: color 0.15s;
}
.what-is-this-collapsible[open] .what-is-this-summary {
    color: var(--accent);
}
.what-is-this-summary:hover {
    color: var(--accent);
}
.what-is-this-summary::-webkit-details-marker {
    display: none;
}
.what-is-this-summary::before {
    content: '▸ ';
    font-size: 0.6rem;
    margin-right: 2px;
}
.what-is-this-collapsible[open] .what-is-this-summary::before {
    content: '▾ ';
}
.what-is-this-content {
    padding: 10px 14px;
    font-size: 0.72rem;
    color: var(--text);
    line-height: 1.6;
    border-top: 1px solid var(--border);
    background: var(--surface-2);
}
.what-is-this-content .witi-step {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    margin-bottom: 0.5rem;
}
.what-is-this-content .witi-step:last-child {
    margin-bottom: 0;
}
.what-is-this-content .witi-icon {
    flex-shrink: 0;
    font-size: 0.85rem;
    line-height: 1.3;
}
.what-is-this-content .witi-text {
    font-size: 0.72rem;
    color: var(--text);
    line-height: 1.55;
}
.what-is-this-content .witi-text strong {
    color: var(--accent);
    font-weight: 600;
}

.config-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    cursor: pointer;
    transition: background 0.15s;
    border-bottom: 1px solid var(--border);
}

.config-item:last-child {
    border-bottom: none;
}

.config-item:hover {
    background: var(--surface-2);
}

.config-item.selected {
    background: rgba(43, 158, 179, 0.08);
}

.config-item-swatches {
    display: flex;
    gap: 2px;
}

.config-item-swatch {
    width: 12px;
    height: 12px;
    border-radius: 2px;
    border: 1px solid rgba(120, 150, 175, 0.15);
}

.config-item-info {
    flex: 1;
    font-size: 10px;
    color: var(--text-muted);
}

.config-item-name {
    font-weight: 500;
    color: var(--text);
}

.config-item-delete {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: transparent;
    border: none;
    color: var(--text-muted);
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.15s, color 0.15s;
}

.config-item:hover .config-item-delete {
    opacity: 1;
}

.config-item-delete:hover {
    color: #ef4444;
}

.config-item-save {
    padding: 2px 8px;
    border-radius: 4px;
    background: var(--accent);
    color: #ffffff;
    border: 1px solid var(--accent-dim);
    font-size: 10px;
    cursor: pointer;
    white-space: nowrap;
    transition: background 0.15s;
    flex-shrink: 0;
}

.config-item-save:hover {
    background: var(--accent-dim);
}

.config-item-save.saved {
    background: transparent;
    color: #22c55e;
    cursor: default;
    display: flex;
    align-items: center;
    gap: 3px;
    padding: 2px 4px;
}

.config-item-save.saved .save-check {
    font-weight: 700;
    font-size: 12px;
}

.config-item-save.saved .save-text {
    font-size: 9px;
    font-weight: 500;
}

/* Resizable preview panel */
.canvas-area {
    position: relative;
    min-width: 300px;
}

.resize-handle.hidden {
    display: none;
}

.resize-handle {
    position: absolute;
    background: var(--border);
    transition: background 0.15s;
    z-index: 500;
}

.resize-handle:hover,
.resize-handle.active {
    background: var(--accent);
}

.resize-handle-right {
    right: -4px;
    top: 0;
    bottom: 0;
    width: 8px;
    cursor: ew-resize;
}

.resize-handle-bottom {
    left: 0;
    right: 0;
    bottom: -4px;
    height: 8px;
    cursor: ns-resize;
}

.resize-handle-corner {
    right: -4px;
    bottom: -4px;
    width: 12px;
    height: 12px;
    cursor: nwse-resize;
    border-radius: 0 0 4px 0;
}

/* Responsive layout */
.workspace {
    display: flex;
    flex-wrap: nowrap;
    gap: 1.5rem;
    align-items: flex-start;
}

.canvas-area {
    flex: 1 1 400px;
    min-width: 300px;
    max-width: 100%;
}

.sidebar {
    flex: 0 1 500px;
    min-width: 320px;
    max-width: 100%;
}

/* When viewport is narrow, stack everything */
@media (max-width: 950px) {
    .workspace {
        flex-direction: column;
    }

    .canvas-area {
        flex: 0 0 auto;
        width: 100% !important;
    }

    .sidebar {
        flex: 0 0 auto;
        width: 100%;
        min-width: 0;
    }
}

/* Prevent column wrapping in palette mapping - NEVER wrap */
.mapping-columns {
    flex-wrap: nowrap !important;
    overflow-x: visible;
}

.mapping-targets-row {
    flex-wrap: nowrap !important;
    overflow: visible;
}

.mapping-targets-column {
    overflow: visible;
}

.column-target {
    overflow: visible;
}

/* Allow overflow for dropdowns, scroll on panel level if needed */
.column-mapping-container {
    overflow: visible;
}

/* Canvas wrapper auto-size */
.canvas-wrapper.auto-size {
    min-height: auto;
}

.canvas-wrapper.auto-size #canvasInner {
    display: flex;
    align-items: flex-start;
    justify-content: center;
}

/* Panel responsive - each panel is a separate unit */
.panel {
    width: 100%;
}

/* ============================================ */
/* Progressive Disclosure UI (v24)              */
/* ============================================ */

/* Initial centered state - canvas area centered, 50% width */
.workspace.centered-initial {
    justify-content: center;
}

.workspace.centered-initial .canvas-area {
    flex: 0 0 50%;
    max-width: 50%;
}

/* After image loaded - canvas 60%, sidebar fills rest */
.workspace.image-loaded {
    justify-content: flex-start;
}

.workspace.image-loaded .canvas-area {
    flex: 0 0 60%;
    max-width: 60%;
}

.workspace.image-loaded .sidebar {
    flex: 1 1 0;
    min-width: 320px;
}

/* Hidden sidebar */
.sidebar.hidden {
    display: none;
}

/* Hidden panel */
.panel.hidden {
    display: none;
}

/* Grayed out recolored strip (before recolor is applied) */
.color-strip.grayed-out {
    opacity: 0.3;
    filter: grayscale(1);
}

/* Pick Colors sidebar button */
.pick-colors-sidebar-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.6rem 1rem;
    font-size: 0.85rem;
}

.pick-colors-sidebar-btn.active {
    background: var(--surface-2);
    border: 2px solid var(--accent);
    color: var(--accent);
    font-size: 0.75rem;
}

.pick-colors-sidebar-btn.active .step-circle-btn {
    background: var(--accent);
    color: white;
}

.pick-colors-sidebar-btn.colors-picked {
    background: var(--surface-2);
    border: 1px dashed var(--accent);
    color: var(--accent);
    font-size: 0.75rem;
}

.pick-colors-sidebar-btn.colors-picked:hover {
    background: rgba(43, 158, 179, 0.08);
}

.picker-toggle-btn.colors-picked {
    border: 1px dashed var(--accent);
    color: var(--accent);
    font-size: 11px;
}

/* Description text under pick colors button */
.pick-colors-description {
    font-size: 0.6rem;
    color: var(--text-muted);
    text-align: left;
    line-height: 1.5;
    margin-top: 0.5rem;
    font-style: italic;
    display: inline-block;
    margin-left: auto;
    margin-right: auto;
}

/* Center the description block within its parent */
.pick-colors-description-wrapper {
    text-align: center;
}

.pick-colors-description-wrapper.hidden {
    display: none;
}

/* Early import section */
.early-import-section {
    margin-top: 1rem;
    text-align: center;
}

.early-import-section.hidden {
    display: none;
}

/* ===== Demo Mode — yellow striped buttons ===== */
.btn-demo-striped {
    background: repeating-linear-gradient(
        45deg,
        #ffd700,
        #ffd700 8px,
        #ffec80 8px,
        #ffec80 16px
    );
    color: #333;
    font-weight: 700;
    border: 2px solid #daa520;
    border-radius: 6px;
    padding: 0.5rem 1.2rem;
    cursor: pointer;
    transition: filter 0.15s, box-shadow 0.15s;
}
.btn-demo-striped:hover {
    filter: brightness(1.08);
    box-shadow: 0 2px 8px rgba(218, 165, 32, 0.35);
}
/* Semi-transparent backdrop behind button text for readability over stripes */
.demo-label {
    background: rgba(255, 255, 255, 0.7);
    padding: 0.15em 0.5em;
    border-radius: 3px;
    display: inline-block;
}
/* Demo Image button — positioned outside the upload zone box, bottom-aligned,
   40px gap between button left edge and upload-zone right edge.
   Parent .canvas-area has position:relative and padding:1rem. */
.btn-demo-image {
    position: absolute;
    bottom: 1rem;                           /* colinear with canvas-wrapper bottom edge */
    left: calc(100% - 1rem + 40px);         /* 40px right of canvas-wrapper right edge */
    white-space: nowrap;
    z-index: 5;
}
/* Hide Demo Image button when image is loaded (toggled via JS .hidden class) */
.btn-demo-image.hidden {
    display: none;
}
/* Smaller variant for config rows */
.btn-demo-config {
    padding: 0.35rem 0.8rem;
    font-size: 0.8rem;
}
/* Demo import section in sidebar (beginner mode) */
.demo-import-section {
    margin-top: 0.75rem;
    text-align: center;
}
.demo-import-section.hidden {
    display: none;
}

.btn-subtle {
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 0.4rem 0.75rem;
    color: var(--text-muted);
    font-family: inherit;
    font-size: 0.7rem;
    cursor: pointer;
    transition: all 0.15s;
}

.btn-subtle:hover {
    background: var(--surface-2);
    color: var(--text);
    border-color: var(--text-muted);
}

/* Target Selector big button */
.btn-large {
    padding: 0.75rem 1rem;
    font-size: 1rem;
    font-weight: 600;
    letter-spacing: 0.02em;
}

#targetSelectorBtn.hidden {
    display: none;
}

/* Target Choice box styles */
.target-choice-description {
    font-size: 0.65rem;
    color: var(--text-muted);
    margin-bottom: 0.75rem;
    font-style: italic;
    line-height: 1.5;
}

/* Collapsible tool sections in Target Choice */
.target-tool-section {
    border: 1px solid var(--border);
    border-radius: 6px;
    margin-bottom: 0.5rem;
    overflow: hidden;
}

.target-tool-summary {
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text);
    background: var(--surface-2);
    user-select: none;
    transition: background 0.15s;
    list-style: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.target-tool-summary::-webkit-details-marker {
    display: none;
}

.target-tool-summary::before {
    content: '▸';
    font-size: 0.7rem;
    color: var(--text-muted);
    transition: transform 0.15s;
}

.target-tool-section[open] > .target-tool-summary::before {
    transform: rotate(90deg);
}

.target-tool-summary:hover {
    background: #dde8ef;
}

.tool-summary-icon {
    vertical-align: -3px;
    margin-right: 2px;
}

.target-tool-content {
    padding: 0.75rem;
}

/* Origin collapsible within Palette Mapping panel */
.origin-collapsible {
    margin-bottom: 0;
    overflow: visible;
}

.origin-collapsible .target-tool-content {
    padding: 0.5rem 0.25rem 0.25rem;
}

/* Algorithm toggle at bottom of Target Choice */
.color-adjust-box {
    margin-top: 0.75rem;
    padding: 8px 10px;
    background: var(--bg);
    border-radius: 6px;
    border: 1px solid var(--border);
}

.color-adjust-box-title {
    font-size: 0.8rem;
    color: var(--text);
    font-weight: 600;
    display: block;
    margin-bottom: 6px;
}

.algorithm-toggle-sublabel {
    font-size: 0.65rem;
    color: var(--text-muted);
    font-weight: 500;
}

.algorithm-toggle-bottom {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    font-size: 10px;
    color: var(--text-muted);
    margin-top: 0.35rem;
}

/* Zoom hint note */
.zoom-hint-note {
    font-size: 8px;
    color: var(--text-muted);
    text-align: center;
    padding: 2px 4px;
    line-height: 1.3;
    white-space: nowrap;
}

/* Picker pan hint */
.picker-pan-hint {
    font-size: 9px;
    color: var(--text-muted);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 4px 8px;
    text-align: center;
    font-style: italic;
}

.picker-pan-hint.hidden {
    display: none;
}

/* Hidden swatch buttons (before target selection) */
.swatch-buttons.target-hidden {
    display: none;
}

/* Blank target swatch placeholder — bucket replaces the dashed box */
.color-slot.blank-target {
    border: 2px dashed var(--text-muted);
    background: transparent;
    position: relative;
    background-image: url('bucket.svg');
    background-size: 28px 28px;
    background-repeat: no-repeat;
    background-position: center;
    opacity: 0.35;
}

/* Targets that are not yet selectable (before target selector is engaged) */
.color-slot.not-selectable {
    cursor: default;
    pointer-events: none;
    opacity: 0.7;
}

.color-slot.not-selectable:hover {
    transform: none;
}

/* Live preview toggle wrapper hidden state */
.live-preview-toggle.hidden {
    display: none;
}

/* Shuffle row hidden state */
.shuffle-row.hidden {
    display: none;
}

/* Quick Harmony Overlay (in canvas-wrapper, below zoom slider on left) */
.quick-harmony-overlay {
    /* Flows as flex child of canvas-tools-column, directly below zoom slider */
}
.quick-harmony-overlay.hidden {
    display: none;
}

.quick-harmony-overlay-panel {
    background: var(--surface);
    opacity: 0.93;
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 8px 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 140px;
    max-width: 170px;
    box-shadow: 0 2px 6px rgba(120, 150, 175, 0.1);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
}
.quick-harmony-overlay-panel.hidden {
    display: none;
}

.quick-harmony-overlay-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 4px;
}
.quick-harmony-overlay-title {
    font-size: 0.68rem;
    font-weight: 700;
    color: var(--text);
    text-transform: uppercase;
    letter-spacing: 0.03em;
}
.quick-harmony-collapse-btn {
    width: 18px;
    height: 18px;
    padding: 0;
    border: none;
    border-radius: 4px;
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 11px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
}
.quick-harmony-collapse-btn:hover {
    background: rgba(0,0,0,0.06);
    color: var(--text);
}

/* Collapsed tab — same position as the expanded panel (below zoom slider) */
.quick-harmony-tab {
    width: 32px;
    height: 32px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--surface);
    color: var(--accent);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 6px rgba(120, 150, 175, 0.1);
    transition: all 0.15s;
    padding: 0;
}
.quick-harmony-tab.hidden {
    display: none;
}
.quick-harmony-tab:hover {
    background: rgba(43, 158, 179, 0.08);
    border-color: var(--accent);
}

/* Overlay mode toggle — vertical layout */
.quick-harmony-overlay .quick-harmony-mode-toggle {
    display: flex;
    align-items: center;
    gap: 4px;
    justify-content: center;
}
.quick-harmony-overlay .quick-harmony-mode-label {
    font-size: 0.62rem;
}
.quick-harmony-overlay .quick-harmony-mode-switch {
    width: 28px;
    height: 14px;
}
.quick-harmony-overlay .quick-harmony-mode-switch::after {
    width: 10px;
    height: 10px;
    top: 1px;
    left: 2px;
}
.quick-harmony-overlay .quick-harmony-mode-switch.color-mode::after {
    left: 15px;
}

/* Wrapper uses CSS grid so both control sets overlap in the same cell.
   The grid cell sizes to the taller child (Harmony), keeping panel height stable. */
.quick-harmony-overlay .quick-harmony-controls-wrapper {
    display: grid;
}
.quick-harmony-overlay .quick-harmony-controls-wrapper > * {
    grid-row: 1;
    grid-column: 1;
}

/* Overlay controls — stacked vertically */
.quick-harmony-overlay .quick-harmony-controls {
    display: flex;
    flex-direction: column;
    gap: 4px;
}
.quick-harmony-overlay .quick-harmony-controls.hidden {
    visibility: hidden;
    pointer-events: none;
}

.quick-harmony-overlay .quick-harmony-select {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 5px;
    padding: 3px 5px;
    color: var(--text);
    font-family: inherit;
    font-size: 0.65rem;
    cursor: pointer;
}
.quick-harmony-overlay .quick-harmony-select:focus {
    outline: none;
    border-color: var(--accent);
}

.quick-harmony-overlay .quick-harmony-btn {
    width: 100%;
    white-space: nowrap;
    font-size: 0.65rem !important;
    padding: 3px 6px !important;
    text-align: center;
}

.quick-harmony-overlay .quick-harmony-result {
    font-size: 0.6rem;
}
.quick-harmony-overlay .quick-harmony-result.hidden {
    display: none;
}

.quick-harmony-overlay .quick-lock-color-select-wrapper {
    display: flex;
    flex-wrap: wrap;
    gap: 3px;
    justify-content: center;
}
.quick-harmony-overlay .quick-locked-btn-wrapper {
    display: flex;
    justify-content: center;
    margin-left: 0;
}

/* Action row below image: keyboard hints left, buttons right */
.image-action-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
    width: 100%;
}
.image-action-row.hidden {
    display: none;
}
.image-action-row .keyboard-hints {
    margin: 0;
}
.image-action-buttons {
    display: flex;
    gap: 0.5rem;
    margin-left: auto;
}
.image-action-buttons .btn {
    font-size: 0.7rem;
    padding: 0.35rem 0.8rem;
    line-height: 1.3;
}

.tool-legend-panel {
    margin-top: 0.75rem;
    padding: 0.75rem;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
}

.tool-legend-panel.hidden {
    display: none;
}

.tool-legend-title {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 0.4rem;
}

.tool-legend-grid {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
}

.tool-legend-item {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    font-size: 0.6rem;
    color: var(--text-muted);
    line-height: 1.4;
}

.tool-legend-emoji {
    font-size: 0.8rem;
    flex-shrink: 0;
    width: 1.2rem;
    text-align: center;
}

.tool-legend-desc strong {
    color: var(--text);
}

.tool-legend-divider {
    border-top: 1px solid var(--border);
    margin: 0.3rem 0;
}

.tool-legend-subtitle {
    font-size: 0.6rem;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 0.1rem;
}

/* ============================================ */
/* Debug Console (always visible in advanced)   */
/* ============================================ */

.debug-console {
    margin-top: 0.75rem;
    width: 100%;
    box-sizing: border-box;
    border: 1px solid #e08530;
    border-radius: 8px;
    background: #1a1a2e;
    color: #d4d4d4;
    font-family: 'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace;
    font-size: 0.65rem;
    overflow: hidden;
}

.debug-console-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.35rem 0.6rem;
    background: #e08530;
    color: #fff;
    font-weight: 600;
    font-size: 0.7rem;
    cursor: pointer;
    user-select: none;
}

.debug-console-controls {
    display: flex;
    align-items: center;
    gap: 0.35rem;
}

.debug-btn {
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 5px;
    color: #444;
    font-size: 0.7rem;
    font-weight: 600;
    cursor: pointer;
    padding: 0.2rem 0.5rem;
    line-height: 1.3;
    white-space: nowrap;
}

.debug-btn:hover {
    background: #f0f0f0;
    border-color: #999;
}

.debug-btn-record {
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.debug-btn-record .record-dot {
    font-size: 0.75rem;
    color: rgba(255,68,68,0.4);
    line-height: 1;
}

.debug-btn-record.active {
    background: #fff0f0;
    border-color: #ff4444;
    color: #cc0000;
}

.debug-btn-record.active .record-dot {
    color: #ff4444;
    text-shadow: 0 0 4px rgba(255,68,68,0.8);
}

.debug-btn-eyedropper {
    display: flex;
    align-items: center;
    gap: 0.2rem;
}

.debug-btn-eyedropper.active {
    background: #f0f5ff;
    border-color: #4488ff;
    color: #0044cc;
    box-shadow: 0 0 4px rgba(68,136,255,0.4);
}

/* Eyedropper overlay — visual indicator only (pointer-events: none).
   Clicks are captured by a document-level listener, not the overlay.
   This allows scrolling to work normally through the overlay. */
#eyedropperOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 99999;
    cursor: crosshair;
    pointer-events: none;
    background: transparent;
    /* Subtle border glow to indicate probe mode is active */
    box-shadow: inset 0 0 0 3px rgba(68, 136, 255, 0.35);
}

/* When probe is active, everything gets crosshair cursor */
body.probe-active,
body.probe-active * {
    cursor: crosshair !important;
}

.debug-collapse-arrow {
    font-size: 0.7rem;
    transition: transform 0.15s;
    color: #fff;
    margin-left: 0.15rem;
}

.debug-console.collapsed .debug-collapse-arrow {
    transform: rotate(-90deg);
}

.debug-console.collapsed .debug-console-body {
    display: none;
}

.debug-console-body {
    padding: 0.5rem 0.6rem;
    max-height: 200px;
    overflow-y: auto;
    white-space: pre-wrap;
    word-break: break-all;
    line-height: 1.5;
}

.debug-console-body .log-entry {
    margin-bottom: 2px;
}

.debug-console-body .log-time {
    color: #888;
}

.debug-console-body .log-info {
    color: #7ec8e3;
}

.debug-console-body .log-warn {
    color: #e0c040;
}

.debug-console-body .log-error {
    color: #e06060;
}

.debug-console-body .log-success {
    color: #60c060;
}

body.mode-beginner .debug-console {
    display: none !important;
}

/* ============================================ */
/* Step Number Circles                          */
/* ============================================ */

.step-circle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--accent);
    color: white;
    font-size: 0.85rem;
    font-weight: 700;
    flex-shrink: 0;
    line-height: 1;
}

/* Step circle inside buttons — smaller, left-aligned */
.step-circle-btn {
    width: 22px;
    height: 22px;
    font-size: 0.7rem;
    background: rgba(255, 255, 255, 0.3);
    color: white;
    margin-right: 4px;
}

.btn-with-step {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
}

/* ============================================ */
/* Live Preview Toggle (below Apply Recolor)    */
/* ============================================ */

.live-preview-toggle-below {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
    padding: 8px 14px;
    margin-top: 6px;
    border-radius: 6px;
    border: 2px dashed var(--border);
    background: var(--surface);
    transition: background 0.15s, border-color 0.15s;
}

.live-preview-toggle-below:hover {
    background: rgba(43, 158, 179, 0.06);
    border-color: var(--accent);
}

.live-preview-toggle-below input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: var(--accent);
}

.live-preview-toggle-below .live-preview-label {
    font-size: 0.85rem;
    color: var(--text-muted);
    font-weight: 500;
    user-select: none;
}

.live-preview-toggle-below input:checked + .live-preview-label {
    color: var(--accent);
    font-weight: 700;
}

/* Active glow state when live preview is checked */
.live-preview-toggle-below:has(input:checked) {
    border-color: var(--accent);
    background: rgba(43, 158, 179, 0.08);
}

.live-preview-toggle-below.hidden {
    display: none;
}

/* Apply Recolor button in "live active" state — muted style */
.btn-live-inactive {
    background: var(--surface-2) !important;
    color: var(--text-muted) !important;
    border: 1px solid var(--border) !important;
    cursor: default !important;
    opacity: 0.7;
}

.btn-live-inactive:hover {
    background: var(--surface-2) !important;
}

.btn-live-inactive .step-circle-btn {
    background: rgba(0, 0, 0, 0.1);
    color: var(--text-muted);
}

/* ============================================ */
/* Origin Drag Hint                             */
/* ============================================ */

.origin-drag-hint {
    font-size: 0.6rem;
    color: var(--text-muted);
    font-style: italic;
    text-align: center;
    margin-bottom: 6px;
    padding: 2px 0;
}

.apply-recolor-group {
    display: flex;
    flex-direction: column;
    align-items: stretch;
}

/* ============================================ */
/* Tutorial Overlay for Color Picker            */
/* ============================================ */

/* Tutorial panel — sits above canvas-wrapper in normal document flow */
.tutorial-panel {
    background: rgba(20, 30, 40, 0.95);
    display: flex;
    flex-direction: column;
    padding: 14px 16px 10px;
    border-radius: 8px 8px 0 0;
    border: 2px solid rgba(120, 150, 175, 0.35);
    border-bottom: 1px solid rgba(120, 150, 175, 0.2);
    overflow: hidden;
}

.tutorial-panel.hidden {
    display: none;
}

/* When tutorial panel is visible, remove top border-radius from canvas-wrapper below it */
.tutorial-panel:not(.hidden) + .canvas-wrapper {
    border-radius: 0 0 8px 8px;
}

.tutorial-content {
    display: flex;
    flex: 1;
    gap: 16px;
    min-height: 0;
    overflow: hidden;
}

.tutorial-left {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    gap: 6px;
    overflow-y: auto;
    min-height: 0;
}

.tutorial-text {
    color: #ffffff;
    font-size: 1.0rem;
    line-height: 1.55;
}

.tutorial-text .tutorial-title {
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: 4px;
}

.tutorial-text .tutorial-subtitle {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.85);
}

.btn-lock-bg-tutorial {
    display: inline-block;
    margin-top: 8px;
    padding: 6px 14px;
    font-size: 0.85rem;
    font-weight: 600;
    color: #fff;
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.15s;
}
.btn-lock-bg-tutorial:hover {
    background: rgba(255, 255, 255, 0.25);
}
.btn-lock-bg-tutorial.active {
    background: rgba(255, 200, 50, 0.45);
    border-color: rgba(255, 200, 50, 0.7);
    box-shadow: 0 0 8px rgba(255, 200, 50, 0.4);
}

.tutorial-text .tutorial-italic {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
    margin-top: 4px;
}

.tutorial-text .highlight-bg {
    color: #6ecfdf;
    font-weight: 700;
}

.tutorial-text .highlight-locked {
    color: #f0a050;
    font-weight: 700;
}

.tutorial-text .highlight-accent {
    color: #a8e06c;
    font-weight: 700;
}

.tutorial-hints {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    flex-shrink: 0;
}

.tutorial-hint-item {
    font-size: 0.6rem;
    color: rgba(255, 255, 255, 0.4);
    font-style: italic;
}

.tutorial-hint-item.tutorial-ctrl-hint {
    font-size: 0.78rem;
    font-weight: 700;
    color: rgba(255, 255, 255, 0.75);
    font-style: normal;
}

.tutorial-right {
    flex: 0 0 200px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    overflow-y: auto;
}

.tutorial-right .picker-category-selector {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
}

.tutorial-right .picker-category-label {
    color: rgba(255, 255, 255, 0.7);
}

.tutorial-right .picker-category-selector select {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
    color: #ffffff;
}

.tutorial-right .picker-swatches-list {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.15);
    /* Cap at ~3 swatch items (each ~32px + 4px gap + 12px container padding), then scroll */
    max-height: 116px;
    overflow-y: auto;
}

.tutorial-right .picker-swatch-info {
    color: rgba(255, 255, 255, 0.7);
}

.tutorial-right .picker-swatch-category {
    color: #f0a050;
}
.tutorial-right .picker-swatch-category.clickable:hover {
    background: #f0a050;
    color: #fff;
}

.tutorial-right .picker-clear-btn {
    color: rgba(255, 255, 255, 0.6);
    border-color: rgba(255, 255, 255, 0.2);
    font-size: 9px;
    padding: 3px 8px;
}

.tutorial-right .picker-clear-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #ffffff;
}

.tutorial-hint-item.tutorial-shift-hint {
    font-size: 0.65rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.55);
}

.tutorial-right .tutorial-orange-hint {
    font-size: 0.55rem;
    color: rgba(255, 255, 255, 0.35);
    font-style: italic;
    text-align: center;
    padding: 2px 0 0;
}

.tutorial-bottom-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 6px;
    padding-top: 6px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.tutorial-bottom-left {
    display: flex;
    align-items: center;
    gap: 10px;
}

.tutorial-bottom-left .tutorial-ctrl-hint {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgba(255, 255, 255, 0.35);
    font-style: italic;
}

.tutorial-hide-btn {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.25);
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.78rem;
    padding: 3px 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.15s;
}

.tutorial-hide-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.8);
}

.tutorial-buttons-right {
    display: flex;
    align-items: center;
    gap: 8px;
}

.tutorial-next-btn {
    background: var(--accent);
    border: none;
    color: #ffffff;
    font-size: 0.85rem;
    font-weight: 600;
    padding: 5px 14px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.15s;
}

.tutorial-next-btn:hover {
    background: var(--accent-dim);
}

.tutorial-finish-btn {
    background: #28a745;
    border: none;
    color: #ffffff;
    font-size: 0.82rem;
    font-weight: 600;
    padding: 5px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.15s;
}

.tutorial-finish-btn:hover {
    background: #218838;
}

.tutorial-next-btn-warn {
    background: #dc3545 !important;
    font-size: 0.78rem !important;
}
.tutorial-next-btn-warn:hover {
    background: #c82333 !important;
}

.tutorial-green-reminder {
    color: #28a745;
    font-size: 0.65rem;
    font-style: italic;
    margin-top: 4px;
}

.tutorial-finish-btn.hidden {
    display: none;
}

/* Tutorial collapsed tab — overlaps into top of canvas-wrapper, hanging down */
.tutorial-tab {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    z-index: 250;
    background: rgba(20, 30, 40, 0.85);
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.65rem;
    font-weight: 600;
    padding: 2px 16px 5px;
    border-radius: 0 0 8px 8px;
    cursor: pointer;
    transition: all 0.15s;
    letter-spacing: 0.03em;
    border: none;
}

.tutorial-tab:hover {
    background: rgba(20, 30, 40, 0.95);
    color: #ffffff;
}

.tutorial-tab.hidden {
    display: none;
}

/* Export button active state */
.btn-export-active {
    background: var(--accent) !important;
    color: #ffffff !important;
    border-color: var(--accent) !important;
    font-weight: 600 !important;
}

.btn-export-active:hover {
    background: var(--accent-dim) !important;
    border-color: var(--accent-dim) !important;
}

/* Activate Mini-tool button in Color Harmony sidebar */
.btn-activate-minitool {
    margin-top: 0.5rem;
    background: var(--surface-2);
    border: 1px dashed var(--accent);
    color: var(--accent);
    font-size: 0.7rem;
    font-weight: 600;
    padding: 6px 10px;
    transition: all 0.15s;
}
.btn-activate-minitool:hover {
    background: rgba(43, 158, 179, 0.1);
    border-style: solid;
}

/* Beginner mode: Recolor Live standalone button (replaces Apply) */
body.mode-beginner .live-preview-toggle-below {
    margin-top: 0;
}
body.mode-beginner .apply-recolor-group {
    display: flex;
    flex-direction: column;
    align-items: stretch;
}

/* Live preview toggle as primary button in beginner mode */
body.mode-beginner .live-preview-toggle-below {
    padding: 10px 14px;
    border-radius: 8px;
    background: var(--accent);
    border: 1px solid var(--accent);
    color: #fff;
}
body.mode-beginner .live-preview-toggle-below .live-preview-label {
    color: #fff;
}
body.mode-beginner .live-preview-toggle-below:has(input:checked) {
    background: rgba(43, 158, 179, 0.08);
    border-color: var(--accent);
}
body.mode-beginner .live-preview-toggle-below:has(input:checked) .live-preview-label {
    color: var(--text);
}
body.mode-beginner .live-preview-toggle-below .live-preview-label {
    font-size: 0.8rem;
    font-weight: 600;
}
/* Show step number in beginner mode */
body.mode-beginner .live-step-num {
    display: inline-flex !important;
    width: 22px;
    height: 22px;
    font-size: 0.7rem;
    margin-right: 6px;
    vertical-align: middle;
    background: #ffffff;
    color: var(--accent);
}
/* When checked (live is on), revert step circle to normal accent style */
body.mode-beginner .live-preview-toggle-below:has(input:checked) .live-step-num {
    background: var(--accent);
    color: #ffffff;
}
