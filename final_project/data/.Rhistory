max_cost_per_dose_2022 = if_else(number_of_manufacturers_2022 == 0, NA, max(`2022_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
min_cost_per_dose_2022 = if_else(number_of_manufacturers_2022 == 0, NA, min(`2022_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
max_cost_per_dose_2023 = if_else(number_of_manufacturers_2023 == 0, NA, max(`2023_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
min_cost_per_dose_2023 = if_else(number_of_manufacturers_2023 == 0, NA, min(`2023_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
.groups = 'drop'
) %>%
#drugs that were on the market in 2019 (i.e. had same time to deflate as revlimid)
filter(number_of_manufacturers_2019==1) %>%
#drugs that had generics produced by 2023 and had time to deflate)
filter(number_of_manufacturers_2023>1) %>%
#filtering out small run productions
filter(doses_given_2023>1000000) %>%
#create price drop and price drop percentage
mutate(price_drop=min_cost_per_dose_2023-min_cost_per_dose_2019) %>%
mutate(price_drop_percentage=((min_cost_per_dose_2023-min_cost_per_dose_2019)/min_cost_per_dose_2019)) %>%
#filter out extremely low cost drugs with negligible room for cost cutting
filter(min_cost_per_dose_2019>.25) %>%
mutate(change_in_manufacturers=number_of_manufacturers_2023-number_of_manufacturers_2019)
write.csv(generic_price_deflation, "./facet_T/generic_price_deflation.csv", row.names = FALSE)
generic_price_deflation %>%
group_by(manufacturer_2019) %>%
summarize(
manufacturer_frequency=n()
) %>%
arrange(desc(manufacturer_frequency))
# After creating generic_price_deflation...
manufacturer_counts <- generic_price_deflation %>%
count(manufacturer_2019, name = "manufacturer_frequency")
generic_price_deflation <- generic_price_deflation %>%
left_join(manufacturer_counts, by = "manufacturer_2019")
write.csv(generic_price_deflation, "./facet_T/generic_price_deflation.csv", row.names = FALSE)
ggplot(generic_price_deflation, aes(x = change_in_manufacturers, y = price_drop_percentage)) +
geom_point() +
labs(x = "Change in Manufacturers", y = "Price Drop Percentage")
model <- lm(price_drop_percentage ~ change_in_manufacturers, data = generic_price_deflation)
ggplot(generic_price_deflation, aes(x = change_in_manufacturers, y = price_drop_percentage)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(x = "Change in Manufacturers", y = "Price Drop Percentage")
slope <- coef(model)[2]
intercept <- coef(model)[1]
r_squared <- summary(model)$r.squared
y_at_x1 <- intercept + slope * 1
x_at_y_neg1 <- (-1 - intercept) / slope
cat("Equation: y =", round(slope, 4), "* x +", round(intercept, 4), "\n")
cat("R² =", round(r_squared, 4), "\n")
cat("Point 1: (1,", round(y_at_x1, 4), ")\n")
cat("Point 2: (", round(x_at_y_neg1, 4), ", -1)\n")
filtered_for_price_drop <- generic_price_deflation %>%
filter(price_drop_percentage <= 0)
filtered_for_price_drop <- filtered_for_price_drop %>%
mutate(
predicted = intercept + slope * change_in_manufacturers,
residual = price_drop_percentage - predicted
)
lower_bound <- quantile(filtered_for_price_drop$residual, 0.05)
upper_bound <- quantile(filtered_for_price_drop$residual, 0.95)
cat("Lower bound (5th percentile):", round(lower_bound, 4), "\n")
cat("Upper bound (95th percentile):", round(upper_bound, 4), "\n")
# The bounds are parallel lines (same slope, shifted intercepts)
intercept_upper <- intercept + upper_bound
intercept_lower <- intercept + lower_bound
y_upper_at_x1 <- intercept_upper + slope * 1
x_upper_at_y_neg1 <- (-1 - intercept_upper) / slope
y_lower_at_x1 <- intercept_lower + slope * 1
x_lower_at_y_neg1 <- (-1 - intercept_lower) / slope
cat("Upper bound: y =", round(slope, 4), "* x +", round(intercept_upper, 4), "\n")
cat("Point 1: (1,", round(y_upper_at_x1, 4), ")\n")
cat("Point 2: (", round(x_upper_at_y_neg1, 4), ", -1)\n\n")
cat("Lower bound: y =", round(slope, 4), "* x +", round(intercept_lower, 4), "\n")
cat("Point 1: (1,", round(y_lower_at_x1, 4), ")\n")
cat("Point 2: (", round(x_lower_at_y_neg1, 4), ", -1)\n")
ggplot(generic_price_deflation, aes(x = change_in_manufacturers, y = price_drop_percentage)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
geom_abline(intercept = intercept_upper, slope = slope, linetype = "dashed") +
geom_abline(intercept = intercept_lower, slope = slope, linetype = "dashed") +
labs(x = "Change in Manufacturers", y = "Price Drop Percentage")
# 8. Datawrapper notation
x_min <- min(generic_price_deflation$change_in_manufacturers)
x_max <- max(generic_price_deflation$change_in_manufacturers)
y_lower_at_xmin <- intercept_lower + slope * x_min
y_lower_at_xmax <- intercept_lower + slope * x_max
y_upper_at_xmin <- intercept_upper + slope * x_min
y_upper_at_xmax <- intercept_upper + slope * x_max
cat("TRENDLINE:\n")
cat("y =", round(slope, 4), "* x +", round(intercept, 4), "\n\n")
cat("SHADED AREA:\n")
cat(round(x_min, 2), ",", round(y_lower_at_xmin, 2), ",",
round(x_min, 2), ",", round(y_upper_at_xmin, 2), ",",
round(x_max, 2), ",", round(y_upper_at_xmax, 2), ",",
round(x_max, 2), ",", round(y_lower_at_xmax, 2),
" @color:gray @opacity:0.3\n")
revlimid_medicare_dose_cost<-read_csv("Revlimid_Medicare.csv", skip=1) %>%
clean_names() %>%
mutate(medicare_avg_cost_unit = as.numeric(gsub("[$,]", "", medicare_avg_cost_unit))) %>%
mutate(medicare_avg_cost_unit = round(medicare_avg_cost_unit, 2)) %>%
glimpse()
revlimid_medicare_dose_cost <- revlimid_medicare_dose_cost %>%
rowwise() %>%
mutate(date = list(c(ymd(paste0(year, "-01-01")), ymd(paste0(year, "-12-31"))))) %>%
unnest(date) %>%
ungroup()
revlimid_full_list_price_history<-read_csv("Revlimid_List_Price.csv", skip=1) %>%
slice(1:(n()-8)) %>%
clean_names() %>%
mutate(effective_date=mdy(effective_date))
glimpse(revlimid_full_list_price_history)
revlimid_wide <- revlimid_full_list_price_history %>%
mutate(drug_id = paste(identifier, dosage, package_size, sep = "_")) %>%
select(effective_date, drug_id, unit) %>%
pivot_wider(names_from = drug_id, values_from = unit)
revlimid_wide_fill <- revlimid_wide %>%
arrange(effective_date) %>%
fill(everything(), .direction = "down")
revlimid_wide_fill <- revlimid_wide_fill %>%
mutate(avg_price = rowMeans(select(., -effective_date), na.rm = TRUE))
revlimid_avg_prices_dw <- revlimid_wide_fill %>%
select(date = effective_date, avg_price)
revlimid_medicare_dose_dw <- revlimid_medicare_dose_cost %>%
select(date, medicare_avg_cost_unit)
#revlimid average price per dose history compared with revilimid medicare spending
dw_revlimid_price_hist_medicare_comp <- revlimid_avg_prices_dw %>%
full_join(revlimid_medicare_dose_dw, by = "date")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(rio)
library(lubridate)
medicare_historic_full<-read_csv("medicare_historic_corrected.csv") %>%
clean_names() %>%
slice_head(n=10)
names(medicare_historic_full) <- sub("^x", "", names(medicare_historic_full))
write.csv(medicare_historic_full, "DATAFRAMEFULL.csv", row.names = FALSE)
total_dosage_units <- medicare_historic_full %>%
select(brand_name, contains("total_dosage_units")) %>%
rename_with(~substr(., 1, 4), -brand_name)
write.csv(total_dosage_units, "./facet/total_dosage_units.csv", row.names = FALSE)
total_spending<- medicare_historic_full %>%
select(brand_name, contains("total_spending")) %>%
rename_with(~substr(., 1, 4), -brand_name)
write.csv(total_spending, "./facet/total_spending.csv", row.names = FALSE)
total_claims <- medicare_historic_full %>%
select(brand_name, contains("total_claims")) %>%
rename_with(~substr(., 1, 4), -brand_name)
write.csv(total_claims, "./facet/total_claims.csv", row.names = FALSE)
total_beneficiaries <- medicare_historic_full %>%
select(brand_name, contains("total_beneficiaries")) %>%
rename_with(~substr(., 1, 4), -brand_name)
write.csv(total_beneficiaries, "./facet/total_beneficiaries.csv", row.names = FALSE)
average_spending_per_dosage_unit_weighted <- medicare_historic_full %>%
select(brand_name, contains("average_spending_per_dosage_unit_weighted")) %>%
rename_with(~substr(., 1, 4), -brand_name)
write.csv(average_spending_per_dosage_unit_weighted, "./facet/average_spending_per_dosage_unit_weighted.csv", row.names = FALSE)
average_spending_per_claim <- medicare_historic_full %>%
select(brand_name, contains("average_spending_per_claim")) %>%
rename_with(~substr(., 1, 4), -brand_name)
write.csv(average_spending_per_claim, "./facet/average_spending_per_claim.csv", row.names = FALSE)
average_spending_per_beneficiary <- medicare_historic_full %>%
select(brand_name, contains("average_spending_per_beneficiary")) %>%
rename_with(~substr(., 1, 4), -brand_name)
write.csv(average_spending_per_beneficiary, "./facet/average_spending_per_beneficiary.csv", row.names = FALSE)
cpi_context_dosage_cost <- read_csv("./facet/cpi_context_dose_cost.csv") %>%
rename(`2019_value` = `2019`,
`2020_value` = `2020`,
`2021_value` = `2021`,
`2022_value` = `2022`,
`2023_value` = `2023`) %>%
mutate(
`2019` = 0,
`2020` = (`2020_value` - `2019_value`) / `2019_value` * 100,
`2021` = (`2021_value` - `2019_value`) / `2019_value` * 100,
`2022` = (`2022_value` - `2019_value`) / `2019_value` * 100,
`2023` = (`2023_value` - `2019_value`) / `2019_value` * 100
) %>%
select(brand_name,`2019`,`2020`,`2021`,`2022`,`2023`)
write.csv(cpi_context_dosage_cost, "./facet/cpi_context_dosage_cost_percent.csv", row.names = FALSE)
total_spending_percent<-total_spending %>%
rename(`2019_value` = `2019`,
`2020_value` = `2020`,
`2021_value` = `2021`,
`2022_value` = `2022`,
`2023_value` = `2023`) %>%
mutate(
`2019` = 0,
`2020` = (`2020_value` - `2019_value`) / `2019_value` * 100,
`2021` = (`2021_value` - `2019_value`) / `2019_value` * 100,
`2022` = (`2022_value` - `2019_value`) / `2019_value` * 100,
`2023` = (`2023_value` - `2019_value`) / `2019_value` * 100
) %>%
select(brand_name,`2019`,`2020`,`2021`,`2022`,`2023`)
write.csv(total_spending_percent, "./facet/total_spending_percent.csv", row.names = FALSE)
full_medicare_d_unfiltered <- read_csv("full_medicare_d_unfiltered.csv") %>%
clean_names()
names(full_medicare_d_unfiltered) <- sub("^x", "", names(full_medicare_d_unfiltered))
write.csv(full_medicare_d_unfiltered, "full_medicare_d_unfiltered_clean.csv", row.names = FALSE)
thalidomide<-full_medicare_d_unfiltered %>%
filter(brand_name %in% c("Revlimid", "Thalomid", "Pomalidomide", "Pomalyst","Lenalidomide"))
total_dosage_units_T <- thalidomide %>%
select(brand_name, manufacturer, contains("total_dosage_units")) %>%
rename_with(~substr(., 1, 4), !c(brand_name, manufacturer))
write.csv(total_dosage_units_T, "./facet_T/total_dosage_units.csv", row.names = FALSE)
total_spending_T<- thalidomide %>%
select(brand_name, manufacturer, contains("total_spending")) %>%
rename_with(~substr(., 1, 4), !c(brand_name, manufacturer))
write.csv(total_spending_T, "./facet_T/total_spending.csv", row.names = FALSE)
total_claims_T <- thalidomide %>%
select(brand_name, manufacturer, contains("total_claims")) %>%
rename_with(~substr(., 1, 4), !c(brand_name, manufacturer))
write.csv(total_claims_T, "./facet_T/total_claims.csv", row.names = FALSE)
total_beneficiaries_T <- thalidomide %>%
select(brand_name, manufacturer, contains("total_beneficiaries")) %>%
rename_with(~substr(., 1, 4), !c(brand_name, manufacturer))
write.csv(total_beneficiaries_T, "./facet_T/total_beneficiaries.csv", row.names = FALSE)
average_spending_per_dosage_unit_weighted_T <- thalidomide %>%
select(brand_name, manufacturer, contains("average_spending_per_dosage_unit_weighted")) %>%
rename_with(~substr(., 1, 4), !c(brand_name, manufacturer))
write.csv(average_spending_per_dosage_unit_weighted_T, "./facet_T/average_spending_per_dosage_unit_weighted.csv", row.names = FALSE)
average_spending_per_claim_T <- thalidomide %>%
select(brand_name, manufacturer, contains("average_spending_per_claim")) %>%
rename_with(~substr(., 1, 4), !c(brand_name, manufacturer))
write.csv(average_spending_per_claim_T, "./facet_T/average_spending_per_claim.csv", row.names = FALSE)
average_spending_per_beneficiary_T <- thalidomide %>%
select(brand_name, manufacturer, contains("average_spending_per_beneficiary")) %>%
rename_with(~substr(., 1, 4), !c(brand_name, manufacturer))
write.csv(average_spending_per_beneficiary_T, "./facet_T/average_spending_per_beneficiary.csv", row.names = FALSE)
generic_price_deflation<-full_medicare_d_unfiltered %>%
group_by(generic_name) %>%
summarize(
doses_given_2023=sum(`2023_total_dosage_units`),
number_of_manufacturers_2019 = sum(!is.na(`2019_total_spending`)),
number_of_manufacturers_2020 = sum(!is.na(`2020_total_spending`)),
number_of_manufacturers_2021 = sum(!is.na(`2021_total_spending`)),
number_of_manufacturers_2022 = sum(!is.na(`2022_total_spending`)),
number_of_manufacturers_2023 = sum(!is.na(`2023_total_spending`)),
manufacturer_2019 = first(manufacturer[!is.na(`2019_total_spending`)]),
brand_name_2019 = first(brand_name[!is.na(`2019_total_spending`)]),
max_cost_per_dose_2019 = if_else(number_of_manufacturers_2019 == 0, NA, max(`2019_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
min_cost_per_dose_2019 = if_else(number_of_manufacturers_2019 == 0, NA, min(`2019_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
max_cost_per_dose_2020 = if_else(number_of_manufacturers_2020 == 0, NA, max(`2020_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
min_cost_per_dose_2020 = if_else(number_of_manufacturers_2020 == 0, NA, min(`2020_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
max_cost_per_dose_2021 = if_else(number_of_manufacturers_2021 == 0, NA, max(`2021_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
min_cost_per_dose_2021 = if_else(number_of_manufacturers_2021 == 0, NA, min(`2021_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
max_cost_per_dose_2022 = if_else(number_of_manufacturers_2022 == 0, NA, max(`2022_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
min_cost_per_dose_2022 = if_else(number_of_manufacturers_2022 == 0, NA, min(`2022_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
max_cost_per_dose_2023 = if_else(number_of_manufacturers_2023 == 0, NA, max(`2023_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
min_cost_per_dose_2023 = if_else(number_of_manufacturers_2023 == 0, NA, min(`2023_average_spending_per_dosage_unit_weighted`, na.rm = TRUE)),
.groups = 'drop'
) %>%
#drugs that were on the market in 2019 (i.e. had same time to deflate as revlimid)
filter(number_of_manufacturers_2019==1) %>%
#drugs that had generics produced by 2023 and had time to deflate)
filter(number_of_manufacturers_2023>1) %>%
#filtering out small run productions
filter(doses_given_2023>1000000) %>%
#create price drop and price drop percentage
mutate(price_drop=min_cost_per_dose_2023-min_cost_per_dose_2019) %>%
mutate(price_drop_percentage=((min_cost_per_dose_2023-min_cost_per_dose_2019)/min_cost_per_dose_2019)) %>%
#filter out extremely low cost drugs with negligible room for cost cutting
filter(min_cost_per_dose_2019>.25) %>%
mutate(change_in_manufacturers=number_of_manufacturers_2023-number_of_manufacturers_2019)
write.csv(generic_price_deflation, "./facet_T/generic_price_deflation.csv", row.names = FALSE)
generic_price_deflation %>%
group_by(manufacturer_2019) %>%
summarize(
manufacturer_frequency=n()
) %>%
arrange(desc(manufacturer_frequency))
# After creating generic_price_deflation...
manufacturer_counts <- generic_price_deflation %>%
count(manufacturer_2019, name = "manufacturer_frequency")
generic_price_deflation <- generic_price_deflation %>%
left_join(manufacturer_counts, by = "manufacturer_2019")
write.csv(generic_price_deflation, "./facet_T/generic_price_deflation.csv", row.names = FALSE)
ggplot(generic_price_deflation, aes(x = change_in_manufacturers, y = price_drop_percentage)) +
geom_point() +
labs(x = "Change in Manufacturers", y = "Price Drop Percentage")
model <- lm(price_drop_percentage ~ change_in_manufacturers, data = generic_price_deflation)
ggplot(generic_price_deflation, aes(x = change_in_manufacturers, y = price_drop_percentage)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(x = "Change in Manufacturers", y = "Price Drop Percentage")
slope <- coef(model)[2]
intercept <- coef(model)[1]
r_squared <- summary(model)$r.squared
y_at_x1 <- intercept + slope * 1
x_at_y_neg1 <- (-1 - intercept) / slope
cat("Equation: y =", round(slope, 4), "* x +", round(intercept, 4), "\n")
cat("R² =", round(r_squared, 4), "\n")
cat("Point 1: (1,", round(y_at_x1, 4), ")\n")
cat("Point 2: (", round(x_at_y_neg1, 4), ", -1)\n")
filtered_for_price_drop <- generic_price_deflation %>%
filter(price_drop_percentage <= 0)
filtered_for_price_drop <- filtered_for_price_drop %>%
mutate(
predicted = intercept + slope * change_in_manufacturers,
residual = price_drop_percentage - predicted
)
lower_bound <- quantile(filtered_for_price_drop$residual, 0.05)
upper_bound <- quantile(filtered_for_price_drop$residual, 0.95)
cat("Lower bound (5th percentile):", round(lower_bound, 4), "\n")
cat("Upper bound (95th percentile):", round(upper_bound, 4), "\n")
# The bounds are parallel lines (same slope, shifted intercepts)
intercept_upper <- intercept + upper_bound
intercept_lower <- intercept + lower_bound
y_upper_at_x1 <- intercept_upper + slope * 1
x_upper_at_y_neg1 <- (-1 - intercept_upper) / slope
y_lower_at_x1 <- intercept_lower + slope * 1
x_lower_at_y_neg1 <- (-1 - intercept_lower) / slope
cat("Upper bound: y =", round(slope, 4), "* x +", round(intercept_upper, 4), "\n")
cat("Point 1: (1,", round(y_upper_at_x1, 4), ")\n")
cat("Point 2: (", round(x_upper_at_y_neg1, 4), ", -1)\n\n")
cat("Lower bound: y =", round(slope, 4), "* x +", round(intercept_lower, 4), "\n")
cat("Point 1: (1,", round(y_lower_at_x1, 4), ")\n")
cat("Point 2: (", round(x_lower_at_y_neg1, 4), ", -1)\n")
ggplot(generic_price_deflation, aes(x = change_in_manufacturers, y = price_drop_percentage)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
geom_abline(intercept = intercept_upper, slope = slope, linetype = "dashed") +
geom_abline(intercept = intercept_lower, slope = slope, linetype = "dashed") +
labs(x = "Change in Manufacturers", y = "Price Drop Percentage")
# 8. Datawrapper notation
x_min <- min(generic_price_deflation$change_in_manufacturers)
x_max <- max(generic_price_deflation$change_in_manufacturers)
y_lower_at_xmin <- intercept_lower + slope * x_min
y_lower_at_xmax <- intercept_lower + slope * x_max
y_upper_at_xmin <- intercept_upper + slope * x_min
y_upper_at_xmax <- intercept_upper + slope * x_max
cat("TRENDLINE:\n")
cat("y =", round(slope, 4), "* x +", round(intercept, 4), "\n\n")
cat("SHADED AREA:\n")
cat(round(x_min, 2), ",", round(y_lower_at_xmin, 2), ",",
round(x_min, 2), ",", round(y_upper_at_xmin, 2), ",",
round(x_max, 2), ",", round(y_upper_at_xmax, 2), ",",
round(x_max, 2), ",", round(y_lower_at_xmax, 2),
" @color:gray @opacity:0.3\n")
revlimid_medicare_dose_cost<-read_csv("Revlimid_Medicare.csv", skip=1) %>%
clean_names() %>%
mutate(medicare_avg_cost_unit = as.numeric(gsub("[$,]", "", medicare_avg_cost_unit))) %>%
mutate(medicare_avg_cost_unit = round(medicare_avg_cost_unit, 2)) %>%
glimpse()
revlimid_medicare_dose_cost <- revlimid_medicare_dose_cost %>%
rowwise() %>%
mutate(date = list(c(ymd(paste0(year, "-01-01")), ymd(paste0(year, "-12-31"))))) %>%
unnest(date) %>%
ungroup()
revlimid_full_list_price_history<-read_csv("Revlimid_List_Price.csv", skip=1) %>%
slice(1:(n()-8)) %>%
clean_names() %>%
mutate(effective_date=mdy(effective_date))
glimpse(revlimid_full_list_price_history)
revlimid_wide <- revlimid_full_list_price_history %>%
mutate(drug_id = paste(identifier, dosage, package_size, sep = "_")) %>%
select(effective_date, drug_id, unit) %>%
pivot_wider(names_from = drug_id, values_from = unit)
revlimid_wide_fill <- revlimid_wide %>%
arrange(effective_date) %>%
fill(everything(), .direction = "down")
revlimid_wide_fill <- revlimid_wide_fill %>%
mutate(avg_price = rowMeans(select(., -effective_date), na.rm = TRUE))
revlimid_avg_prices_dw <- revlimid_wide_fill %>%
select(date = effective_date, avg_price)
revlimid_medicare_dose_dw <- revlimid_medicare_dose_cost %>%
select(date, medicare_avg_cost_unit)
#revlimid average price per dose history compared with revilimid medicare spending
dw_revlimid_price_hist_medicare_comp <- revlimid_avg_prices_dw %>%
full_join(revlimid_medicare_dose_dw, by = "date")
View(dw_revlimid_price_hist_medicare_comp)
dw_revlimid_price_hist_medicare_comp <- dw_revlimid_price_hist_medicare_comp %>%
arrange(date) %>%
fill(avg_price, .direction = "down") %>%
mutate(year = year(date)) %>%
group_by(year) %>%
fill(medicare_avg_cost_unit, .direction = "down") %>%
ungroup()
View(dw_revlimid_price_hist_medicare_comp)
write.csv(dw_revlimid_price_hist_medicare_comp, "datawrapper_revlimid_medicare_price_comparison", row.names = FALSE)
write.csv(dw_revlimid_price_hist_medicare_comp, "datawrapper_revlimid_medicare_price_comparison.csv", row.names = FALSE)
write.csv(dw_revlimid_price_hist_medicare_comp, "datawrapper_revlimid_medicare_price_comparison.csv", row.names = FALSE, na="")
View(revlimid_wide_fill)
View(revlimid_medicare_dose_cost)
View(revlimid_wide)
View(revlimid_wide_fill)
CPI<-read_csv("CPI.csv")
View(CPI)
Inflation_Rates<-read_csv("Inflation_Rates.csv")
Inflation_Rates<-read_csv("Inflation_Rates.csv")
View(Inflation_Rates)
View(dw_revlimid_price_hist_medicare_comp)
View(revlimid_medicare_dose_dw)
View(revlimid_medicare_dose_cost)
View(revlimid_wide_fill)
revlimid_5mg <- revlimid_wide_fill %>%
select(effective_date, `59572-0405-00_5 mg_100s ea`)
View(revlimid_5mg)
Inflation_Rates<-read_csv("Inflation_Rates.csv") %>%
glimpse()
Inflation_Rates<-read_csv("Inflation_Rates.csv") %>%
select(-ave) %>%
pivot_longer(cols = -year, names_to = "month", values_to = "rate")
Inflation_Rates<-read_csv("Inflation_Rates.csv") %>%
select(-ave) %>%
pivot_longer(cols = -year, names_to = "month", values_to = "rate") %>%
glimpse()
Inflation_Rates<-read_csv("Inflation_Rates.csv") %>%
select(-Ave) %>%
pivot_longer(cols = -Year, names_to = "month", values_to = "rate") %>%
glimpse()
View(Inflation_Rates)
Inflation_Rates<-read_csv("Inflation_Rates.csv") %>%
select(-Ave) %>%
pivot_longer(cols = -Year, names_to = "month", values_to = "rate") %>%
head()
head(Inflation_Rates)
Inflation_Rates <- Inflation_Rates %>%
mutate(date = ymd(paste(Year, month, "01", sep = "-")))
Inflation_Rates <- Inflation_Rates %>%
mutate(date = ymd(paste(Year, month, "01", sep = "-")))
head(Inflation_Rates)
View(revlimid_5mg)
Inflation_Rates <- Inflation_Rates %>%
mutate(date = ymd(paste(Year, month, "01", sep = "-"))) %>%
filter(date >= ymd("2005-12-01"))
head(Inflation_Rates)
Inflation_Rates <- Inflation_Rates %>%
mutate(date = ymd(paste(Year, month, "01", sep = "-"))) %>%
head(Inflation_Rates)
Inflation_Rates <- Inflation_Rates %>%
mutate(date = ymd(paste(Year, month, "01", sep = "-")))
head(Inflation_Rates)
Inflation_Rates<-read_csv("Inflation_Rates.csv") %>%
select(-Ave) %>%
pivot_longer(cols = -Year, names_to = "month", values_to = "rate")
Inflation_Rates <- Inflation_Rates %>%
mutate(date = ymd(paste(Year, month, "01", sep = "-")))
head(Inflation_Rates)
Inflation_Rates <- Inflation_Rates %>%
filter(date >= ymd("2005-12-01"))
View(Inflation_Rates)
Inflation_Rates <- Inflation_Rates %>%
arrange(date) %>%
mutate(
rate_decimal = rate / 100,
inflated_value = 258 * cumprod(1 + rate_decimal)
)
View(Inflation_Rates)
Inflation_Rates <- Inflation_Rates %>%
arrange(date) %>%
mutate(
rate_monthly = (rate / 100) / 12,
#divide by 12 for annual->monthly
inflated_value = 258 * cumprod(1 + rate_monthly)
)
Inflation_Rates<-read_csv("Inflation_Rates.csv") %>%
select(-Ave) %>%
pivot_longer(cols = -Year, names_to = "month", values_to = "rate")
Inflation_Rates_dates <- Inflation_Rates %>%
mutate(date = ymd(paste(Year, month, "01", sep = "-")))
head(Inflation_Rates)
Inflation_Rates_dates <- Inflation_Rates_dates %>%
filter(date >= ymd("2005-12-01"))
Inflation_Rates_dates <- Inflation_Rates_dates %>%
filter(date >= ymd("2005-12-01"))
Inflation_Rates_final <- Inflation_Rates_dates %>%
arrange(date) %>%
mutate(
rate_monthly = (rate / 100) / 12,
#divide by 12 for annual->monthly
inflated_value = 258 * cumprod(1 + rate_monthly)
)
View(Inflation_Rates_final)
View(Inflation_Rates)
Inflation_Rates<-read_csv("Inflation_Rates.csv") %>%
select(-Ave) %>%
pivot_longer(cols = -Year, names_to = "month", values_to = "rate")
Inflation_Rates_dates <- Inflation_Rates %>%
mutate(date = ymd(paste(Year, month, "01", sep = "-")))
head(Inflation_Rates)
Inflation_Rates_dates <- Inflation_Rates_dates %>%
filter(date >= ymd("2005-12-01"))
Inflation_Rates_final <- Inflation_Rates_dates %>%
arrange(date) %>%
mutate(
rate_monthly = (rate / 100) / 12,
#divide by 12 for annual->monthly
inflated_value = 258 * cumprod(1 + rate_monthly)
)
View(Inflation_Rates)
tail(Inflation_Rates, 20)
Inflation_Rates<-read_csv("Inflation_Rates.csv") %>%
select(-Ave) %>%
pivot_longer(cols = -Year, names_to = "month", values_to = "rate") %>%
filter(!is.na(Year))
Inflation_Rates_dates <- Inflation_Rates %>%
mutate(date = ymd(paste(Year, month, "01", sep = "-")))
head(Inflation_Rates)
Inflation_Rates_dates <- Inflation_Rates_dates %>%
filter(date >= ymd("2005-12-01"))
Inflation_Rates_final <- Inflation_Rates_dates %>%
arrange(date) %>%
mutate(
rate_monthly = (rate / 100) / 12,
#divide by 12 for annual->monthly
inflated_value = 258 * cumprod(1 + rate_monthly)
)
inflation_join <- Inflation_Rates_final %>%
select(date, inflated_value)
revlimid_5mg_inflation <- revlimid_5mg %>%
full_join(inflation_join, by = c("effective_date" = "date")) %>%
arrange(effective_date)
View(revlimid_5mg_inflation)
write.csv(revlimid_5mg_inflation, "dw_revlimid_5mg_history_inflation.csv", row.names = FALSE, na="")
